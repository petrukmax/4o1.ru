<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fail2ban настройка для ssh apache - guideto</title><meta name="description" content="Всегда есть ненулевая вероятность, что где-нибудь кто-нибудь выберет не столь сложный и надежный пароль, который злоумышленник сможет подобрать простым перебором.Для защиты от такого подбора пароля (такую атаку часто называют брутфорсом - см. Полный перебор) есть удачное и изящное решение - fail2ban. Этот пакет есть в репозиториях, и базовая установка очень проста:sudo apt-get install fail2ban"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://petrukmax.github.io/guideto/fail2ban-nastroyka-dlya-ssh-apache.html"><link rel="alternate" type="application/atom+xml" href="https://petrukmax.github.io/guideto/feed.xml"><link rel="alternate" type="application/json" href="https://petrukmax.github.io/guideto/feed.json"><meta property="og:title" content="Fail2ban настройка для ssh apache"><meta property="og:site_name" content="guideto"><meta property="og:description" content="Всегда есть ненулевая вероятность, что где-нибудь кто-нибудь выберет не столь сложный и надежный пароль, который злоумышленник сможет подобрать простым перебором.Для защиты от такого подбора пароля (такую атаку часто называют брутфорсом - см. Полный перебор) есть удачное и изящное решение - fail2ban. Этот пакет есть в репозиториях, и базовая установка очень проста:sudo apt-get install fail2ban"><meta property="og:url" content="https://petrukmax.github.io/guideto/fail2ban-nastroyka-dlya-ssh-apache.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://petrukmax.github.io/guideto/assets/css/style.css?v=984cc9f9fa9fd7a0b9529b5c6d9033e9"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://petrukmax.github.io/guideto/fail2ban-nastroyka-dlya-ssh-apache.html"},"headline":"Fail2ban настройка для ssh apache","datePublished":"2013-02-28T13:26","dateModified":"2024-08-19T17:47","description":"Всегда есть ненулевая вероятность, что где-нибудь кто-нибудь выберет не столь сложный и надежный пароль, который злоумышленник сможет подобрать простым перебором.Для защиты от такого подбора пароля (такую атаку часто называют брутфорсом - см. Полный перебор) есть удачное и изящное решение - fail2ban. Этот пакет есть в репозиториях, и базовая установка очень проста:sudo apt-get install fail2ban","author":{"@type":"Person","name":"GUIDETO","url":"https://petrukmax.github.io/guideto/authors/admin/"},"publisher":{"@type":"Organization","name":"GUIDETO"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container js-container"><nav class="menu"><ul class="navbar__menu"><li><a href="https://petrukmax.github.io/guideto/tags/kouching/" target="_self">Коучинг</a></li><li><a href="https://petrukmax.github.io/guideto/tags/psixologiya/" target="_self">Психология</a></li><li><a href="https://petrukmax.github.io/guideto/tags/knigi/" target="_self">Книги</a></li><li><a href="https://petrukmax.github.io/guideto/tags/video/" target="_self">Видео</a></li><li><a href="https://petrukmax.github.io/guideto/tags/biz/" target="_self">Бизнес</a></li><li><a href="https://petrukmax.github.io/guideto/tags/bez-rubriki/" target="_self">Без рубрики</a></li><li><a href="https://petrukmax.github.io/guideto/tags/audiobook/" target="_self">Аудиокниги</a></li><li><a href="https://petrukmax.github.io/guideto/tags/anglijskij/" target="_self">Английский</a></li><li class="has-submenu"><a href="https://petrukmax.github.io/guideto/tags/it/" target="_self">IT</a><ul class="navbar__submenu"><li><a href="https://petrukmax.github.io/guideto/tags/wordpress/" target="_self">WordPress</a></li><li><a href="https://petrukmax.github.io/guideto/tags/seo/" target="_self">SEO</a></li><li class="has-submenu"><a href="https://petrukmax.github.io/guideto/tags/yazyki/" target="_self">Языки</a><ul class="navbar__submenu"><li><a href="https://petrukmax.github.io/guideto/tags/html/" target="_self">HTML</a></li><li><a href="https://petrukmax.github.io/guideto/tags/php/" target="_self">PHP</a></li></ul></li><li><a href="https://petrukmax.github.io/guideto/tags/hard/" target="_self">Железо</a></li><li><a href="https://petrukmax.github.io/guideto/tags/android/" target="_self">Android</a></li><li class="has-submenu"><a href="https://petrukmax.github.io/guideto/tags/windows/" target="_self">Windows</a><ul class="navbar__submenu"><li><a href="https://petrukmax.github.io/guideto/tags/iis/" target="_self">IIS</a></li></ul></li><li class="has-submenu"><a href="https://petrukmax.github.io/guideto/tags/unix/" target="_self">Unix</a><ul class="navbar__submenu"><li><a href="https://petrukmax.github.io/guideto/tags/apache/" target="_self">Apache</a></li><li><a href="https://petrukmax.github.io/guideto/tags/asterisk/" target="_self">Asterisk</a></li></ul></li></ul></li></ul></nav><div class="container__content"><header class="top"><div class="top__item"><a class="logo" href="https://petrukmax.github.io/guideto/">guideto</a></div><div class="top__item top__item--right"><button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false"><span class="menu-toggle-box"><span class="menu-toggle-inner">Menu</span></span></button></div></header><main class="main post"><article class="content"><div class="main__left"><figure class="hero"><img src="https://petrukmax.github.io/guideto/media/website/111222-4.jpg" srcset="https://petrukmax.github.io/guideto/media/website/responsive/111222-4-xs.jpg 300w, https://petrukmax.github.io/guideto/media/website/responsive/111222-4-sm.jpg 480w, https://petrukmax.github.io/guideto/media/website/responsive/111222-4-md.jpg 768w, https://petrukmax.github.io/guideto/media/website/responsive/111222-4-lg.jpg 1024w, https://petrukmax.github.io/guideto/media/website/responsive/111222-4-xl.jpg 1280w, https://petrukmax.github.io/guideto/media/website/responsive/111222-4-2xl.jpg 1600w" sizes="(min-width: 1800px) 50vw, (min-width: 900px) 40vw, 100vw" loading="eager" width="3840" height="2160" alt=""></figure><header><h1>Fail2ban настройка для ssh apache</h1><p><time datetime="2013-02-28T13:26">февраль 28, 2013 </time>by <a href="https://petrukmax.github.io/guideto/authors/admin/" rel="author" title="GUIDETO">GUIDETO</a></p></header></div><div class="main__right"><div class="content__entry"><p>Всегда есть ненулевая вероятность, что где-нибудь кто-нибудь выберет не столь сложный и надежный пароль, который злоумышленник сможет подобрать простым перебором.</p><p>Для защиты от такого подбора пароля (такую атаку часто называют брутфорсом - см. Полный перебор) есть удачное и изящное решение - fail2ban. Этот пакет есть в репозиториях, и базовая установка очень проста:</p><pre>sudo apt-get install fail2ban</pre><p></p><p>В состоянии сразу после установки (во всяком случае, в 10.04) защита от брутфорса по SSH включена.</p><p>Основная идея - при превышении заданного числа неудачных вводов пароля подряд (по умолчанию - 6) бан IP, с которого были попытки подбора на заданное время (по умолчанию - 600 секунд).</p><p>Параметры можно посмотреть и поменять в файле <code>/etc/fail2ban/jail.conf</code>. Существующие фильтры (т.е. правила, по которым определяется неудачная попытка ввода пароля) лежат в директории <code>/etc/fail2ban/filter.d/</code> (можно их править или на их основе делать свои фильтры), а существующие правила реагирования - в директории<code>/etc/fail2ban/action.d/</code></p><p>заглянем-ка в файл протокола ошибок apache (<strong>/var/log/httpd/error_log</strong>):</p><pre>[Sat Jan 31 12:05:49 2009] [error] [client 89.18.176.83] <strong>File does not exist</strong>: /var/www/html/bin<restore-line-break><restore-line-break>[Sat Jan 31 12:05:50 2009] [error] [client 89.18.176.83] <strong>File does not exist</strong>: /var/www/html/mail<restore-line-break><restore-line-break>[Sat Jan 31 12:05:52 2009] [error] [client 89.18.176.83] <strong>File does not exist</strong>: /var/www/html/webmail<restore-line-break><restore-line-break>[Sat Jan 31 12:05:53 2009] [error] [client 89.18.176.83] <strong>File does not exist</strong>: /var/www/html/roundcube<restore-line-break><restore-line-break>[Sat Jan 31 12:05:58 2009] [error] [client 89.18.176.83] <strong>File does not exist</strong>: /var/www/html/rc</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p>Насколько я понимаю, данные строки лога показывают, что «некто» пытается найти в моем сервере «нечто». Не знаю, можете называть это паранойей, но мне это очень не нравится! А вдруг найдет? Или вот еще, к примеру, строка из лога:</p><pre>[Mon Jan 26 22:19:46 2009] [error] [client 213.21.37.175] script '/var/www/html/azenv.php' not found or unable to stat</pre><p>Может это самый лучший и самый полезный в мире скрипт, а может быть и нет. Как по мне, так лучше не надо!</p><p>Итак, решено — будем защищаться. fail2ban у меня уже установлен — ssh защищает. Но это далеко не единственная возможность программы. Просто по умолчанию сразу после установки в ней включен единственный фильтр — <strong>sshd.conf</strong>. Вернемся к сути программы fail2ban. Она постоянно анализирует файлы протоколов работы служб компьютера, пытаясь найти в них сообщения об ошибках, соответствующие установленным шаблонам. Если условие совпадает, программа выполняет указанное действие. Условия-шаблоны прописываются в файлах фильтров, расположенных в папке <strong>/etc/fail2ban/filter.d</strong>. Возможные действия представлены файлами, находящимися в папке <strong>/etc/fail2ban/action.d</strong>. Управление «включением» и «выключением» фильтров, а также выбор последующих «действий» осуществляется в файле настроек <strong>/etc/fail2ban/jail.conf</strong>. Борьбу за безопасность apache я начал с поиска подходящего фильтра в папке<strong> /etc/fail2ban/filter.d</strong>. На первый взгляд мне подошел файл фильтра <strong>apache-noscript.conf</strong>. Его я поначалу и задействовал (об этом ниже). Однако, впоследствии, сопоставляя файл протокола ошибок apache и файл протокола работы fail2ban, я заметил, что далеко не все сообщения об ошибках приводят к бану вызвавших их посетителей. Утверждать, что программа не работает, было бы неправдой — на часть ошибок она все-таки реагировала. Следовательно, «что-то не то» с шаблонами. Отличным подспорьем в «разборках» с шаблонами является программа <strong>fail2ban-regex</strong>, устанавливаемая на компьютер вместе с fail2ban. Программа позволяет проанализировать указанный лог (или просто текстовую строку) на предмет нахождения соответствий шаблону из файла фильтра (или просто текстовой строке). Именно этим я и занялся. Взял лог, взял фильтр и «скормил» их програмке — ввел в консоли команду:</p><blockquote><tt><strong>fail2ban-regex /var/log/httpd/error_log apache-noscript.conf</strong></tt></blockquote><p>Первый ответ, о том, что найдено аж 10 совпадений меня очень развеселил.  »Невооруженным глазом» было видно, что в логе их гораздо больше… И начал я подбирать шаблон, попутно проверяя его эффективность все той же приведенной выше командой. Число совпадений росло, сначала три сотни, потом больше тысячи, финальный результат был равен 1706. Я решил, что пока хватит, а дальше посмотрим. Теперь о произведенных мной изменениях. Изначально в файле фильтра <strong>apache-noscript.conf </strong>строка шаблона сообщения об ошибке выглядела так:</p><pre>failregex = [[]client <host>[]] (File does not exist|script not found or unable to stat): .*(\.php|\.asp|\.exe|\.pl)</host></pre><p>Результат, который в конце концов устроил лично меня, выглядит так:</p><pre>failregex = [[]client <host>[]] (File does not exist|Invalid URI in request|.* not found or unable to stat)</host></pre><p>В чем суть моих изменений? Во первых, оригинальная строка шаблона предполагает, что в логе сообщение об ошибке должно содержать что-либо из «.php», «.asp», «.exe» или «.pl». Если же в строке такого нет, шаблон не срабатывает. Но даже в той «нарезке» лога apache, что я привел выше мы видим, что нет там никаких «.php», «.asp», «.exe» или «.pl». Следовательно фильтр не сработает. По этому, окончание шаблона — (\.php|\.asp|\.exe|\.pl) — я попросту выкинул.</p><p>Ну и во вторых, та часть шаблона, которая вылавливает неправильные скрипты. В оригинале она хочет, чтобы в логе был такой текст «<strong><em>script not found or unable to stat</em></strong>» (одним непрерывным куском!!!). Но, посмотрев в свои логи я увидел, что зачастую там текст отформатирован иначе, например так: «script ‘/var/www/html/pt.php’ not found or unable to stat». Следовательно этот фильтр тоже не срабатывал бы. Пришлось его заменить на «<strong><em>.* not found or unable to stat</em></strong>«. В данном случае «<strong>.*</strong>» обозначает «любой текст». После этого фильтр начал срабатывать на сообщения об ошибках о запуске несуществующих скриптов.</p><p>Кстати, дополнительно почитать о «регулярных выражениях» или попросту говоря, шаблонах, можно по ссылке:</p><p>http://www.amk.ca/python/howto/regex/regex.html</p><p>Ну и вкратце о том, как я подключал фильтр. В файле настроек <strong>/etc/fail2ban/jail.conf</strong> я нашел раздел:</p><blockquote><pre>[apache-shorewall]<restore-line-break><restore-line-break><restore-line-break><restore-line-break>enabled  = false<restore-line-break><restore-line-break>filter   = apache-noscript<restore-line-break><restore-line-break>action   = shorewall<restore-line-break><restore-line-break>           sendmail[name=Postfix, dest=you@mail.com]<restore-line-break><restore-line-break>logpath  = /var/log/apache2/error_log</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre></blockquote><p>И изменил его следующим образом:</p><blockquote><pre>[apache-shorewall]<restore-line-break><restore-line-break><restore-line-break><restore-line-break>enabled  = true<restore-line-break><restore-line-break>filter   = apache-noscript<restore-line-break><restore-line-break>action   = shorewall<restore-line-break><restore-line-break>           mail-whois[name=Apache, dest=dmitry@my-svr]<restore-line-break><restore-line-break>logpath  = /var/log/httpd/error_log<restore-line-break><restore-line-break>maxretry = 2</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre></blockquote><p>Таким образом я:</p><ul><li>включил (<strong>enabled = true</strong>)…</li><li>выбранный фильтр (<strong>filter = apache-noscript</strong>)…</li><li>на анализ файла протокола (<strong>logpath = /var/log/httpd/error_log</strong>)…</li><li>и при возникновении 2 ошибок (<strong>maxretry = 2</strong>)…</li><li>доступ блокируется при помощи файервола (<strong>action = shorewall</strong>).</li></ul><p>Вот и все…</p><p>P.S.</p><p>Не вышло «все», однако… 21 марта с одного IP такой «вал валил», что я решил предпринять что-то. И нашел еще один фильтр — <strong>apache-overflows.conf</strong>, который вроде как очень подходил моим потребностям. Судите сами, вот кусок лога apache:</p><pre>[Sat Mar 21 17:19:35 2009] [error] [client 221.223.93.132] Invalid method in request \xf0\xaf\xa0_\x98\x1b\x9fi\xe2\x84\xca\xc8\xca\xfa\xabA\xb4f\xe0+\xf3\x96>S\x90\x90\xc1D\x80\xc2\x11\xe17\xcc\x91\x97<restore-line-break><restore-line-break>[Sat Mar 21 17:20:04 2009] [error] [client 221.223.93.132] Invalid URI in request \xfb%\xd2\ba\xf5\x84\x9c'\x0c\xbc\xf4|\xffu\x10?\xf2\x96\xee\xda\x9d\xe9\x9f\xb0\x15\xc9\xe9nd<restore-line-break><restore-line-break>[Sat Mar 21 17:20:43 2009] [error] [client 221.223.93.132] request failed: error reading the headers</restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p>А вот (но, правда, уже немножко подкорректированный мной) фильтр:</p><pre># Notes.:  Regexp to catch Apache overflow attempts.<restore-line-break><restore-line-break># Values:  TEXT<restore-line-break><restore-line-break>#<restore-line-break><restore-line-break>failregex = [[]client []] (Invalid method in request|Invalid URI in request|request failed: URI too long|request failed: error reading the headers|erroneous characters after protocol string).*<restore-line-break><restore-line-break><restore-line-break><restore-line-break># Option:  ignoreregex<restore-line-break><restore-line-break># Notes.:  regex to ignore. If this regex matches, the line is ignored.<restore-line-break><restore-line-break># Values:  TEXT<restore-line-break><restore-line-break>#<restore-line-break><restore-line-break>ignoreregex =</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p>Пришлось и его включать. С поправкой на тот факт, что мне показалось, что это была именно атака, рубить доступ я решил с первой же попытки. Для этого в файл <strong>/etc/fail2ban/jail.conf</strong> я добавил следующие строки:</p><pre>[apache-overflow]<restore-line-break><restore-line-break>enabled	= true<restore-line-break><restore-line-break>filter	= apache-overflows<restore-line-break><restore-line-break>action	= shorewall<restore-line-break><restore-line-break>logpath	= /var/log/httpd/error_log<restore-line-break><restore-line-break>maxretry = 1</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p>После этого перезапустил fail2ban командой:</p><blockquote><strong><code>fail2ban-client reload</code></strong></blockquote><p>И вот теперь сижу и жду новых поводов для добавления новых фильтров…</p><p>я описал пару фильтров, используемых мной для предотвращения «вражеских» происков, направленных против моего <strong>apache</strong>. Работало все это отлично, и вопросов не возникало. И дальше бы работало, если бы меня не потянуло на разборки с <strong>Chillispot</strong>. Дело в том, что в описанных мной конфигурациях <strong>fail2ban </strong>блокирование нежелательного доступа осуществляется при помощи <strong>shorewall</strong>. А его-то я как раз и поломал, ковыряясь с <strong>Chillispot</strong>. Точнее, не поломал, а отключил, так как для работы <strong>Chillispot</strong> требуется загрузка своего собственого скрипта с правилами для<strong>iptables</strong>, который «множит на ноль» всю работу <strong>shorewall</strong>…</p><p>Чтож, iptables, так iptables. Нам-то какая разница!? Нужно всего-лишь заставить <strong>fail2ban </strong>тоже использовать <strong>iptables</strong> при блокировании доступа. Для этого залез я в файл <strong>/etc/fail2ban/jail.conf</strong> и настройки «тюрем» своих поисправлял следующим образом:</p><blockquote><pre>[apache-shorewall]<restore-line-break><restore-line-break><restore-line-break><restore-line-break>enabled  = true<restore-line-break><restore-line-break>filter   = apache-noscript<restore-line-break><restore-line-break><strong>action = iptables[name=httpd, port=http, protocol=tcp]</strong><restore-line-break><restore-line-break>logpath  = /var/log/httpd/error_log<restore-line-break><restore-line-break>maxretry = 2</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre></blockquote><p>И второй «тюрьме» тоже:</p><blockquote><pre>[apache-overflow]<restore-line-break><restore-line-break>enabled	= true<restore-line-break><restore-line-break>filter	= apache-overflows<restore-line-break><restore-line-break><strong>action = iptables[name=httpd, port=http, protocol=tcp]</strong><restore-line-break><restore-line-break>logpath	= /var/log/httpd/error_log<restore-line-break><restore-line-break>maxretry = 1</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre></blockquote><p>Изменения по сравнению с предыдущим вариантом, описанным мной ранее, для наглядности я выделил красным цветом. Также, если сравнить с предыдущими вариантами, я не стал писать строку со вторым «действием» (action) — отправку письма администратору (mail-whois или sendmail). Ему (мне) и так писем достаточно… Названия самих «тюрем» (те, что в указанных примерах написаны в квадратных скобках) я менять не стал. Они все равно ни на что не влияют, только лишь в лог пишутся.</p><p>После внесения указанных изменений перезапустил fail2ban командой:</p><blockquote><strong><code>fail2ban-client reload</code></strong></blockquote><p>И все! Кстати, есть еще одно отличие у данного варианта блокирования по сравнению с <strong>shorewall</strong>, описанным ранее: <strong>iptables</strong> блокирует только порт<strong>apache</strong>…</p><p>&nbsp;</p><h2>Настройка Fail2ban на Debian</h2><p><strong>Fail2ban</strong> - отслеживает IP адреса с которых производились неудачные повторяющиеся попытки получить доступ по какому-либо из сервисов (SSH, FTP, SMTP, Apache) сервера в файлах журналов.</p><h3><span style="text-decoration: underline;">Установка</span></h3><p>из под root`а выполним:</p><div><div id="highlighter_605274"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div><div><code>aptitude</code><code>install</code> <code>fail2ban</code></div></div></td></tr></tbody></table></div></div><p>После установки Вы можете настроить fail2ban с помощью этих двух файлов, расположенных в /etc/fail2ban/</p><div><div id="highlighter_747957"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div><div><code>/etc/fail2ban/fail2ban</code><code>.conf</code></div><p></p><div><code>/etc/fail2ban/jail</code><code>.conf</code></div></div></td></tr></tbody></table></div></div><p>Откроем jail.conf, что бы включить отслеживание сервисов.</p><div><div id="highlighter_150219"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div><div><code>nano</code><code>/etc/fail2ban/jail</code><code>.conf</code></div></div></td></tr></tbody></table></div></div><p>Теперь можем включить или выключить нужные сервисы.</p><p>По умолчанию отслеживание SSH включено.</p><p>Если Вы хотите добавить отслеживание Apache измените:</p><div><div id="highlighter_183791"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div>1</div><p></p><div>2</div><p></p><div>3</div><p></p><div>4</div><p></p><div>5</div><p></p><div>6</div><p></p><div>7</div><p></p><div>8</div><p></p><div>9</div><p></p><div>10</div><p></p><div>11</div></td><td><div><div><code>#</code></div><p></p><div><code># HTTP servers</code></div><p></p><div><code>#</code></div><p></p><div></div><p></p><div><code>[apache]</code></div><p></p><div></div><p></p><div><code>enabled = false</code></div><p></p><div><code>port    = http</code></div><p></p><div><code>filter  = apache-auth</code></div><p></p><div><code>logpath = /var/log/apache*/*access.log</code></div><p></p><div><code>maxretry = 6</code></div></div></td></tr></tbody></table></div></div><p>на:</p><div><div id="highlighter_126665"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div>1</div><p></p><div>2</div><p></p><div>3</div><p></p><div>4</div><p></p><div>5</div><p></p><div>6</div><p></p><div>7</div><p></p><div>8</div><p></p><div>9</div><p></p><div>10</div><p></p><div>11</div></td><td><div><div><code>#</code></div><p></p><div><code># HTTP servers</code></div><p></p><div><code>#</code></div><p></p><div></div><p></p><div><code>[apache]</code></div><p></p><div></div><p></p><div><code>enabled = true</code></div><p></p><div><code>port    = http</code></div><p></p><div><code>filter  = apache-auth</code></div><p></p><div><code>logpath = /var/log/apache2/*access.log</code></div><p></p><div><code>maxretry = 6</code></div></div></td></tr></tbody></table></div></div><p>Для FTP (proftpd)</p><div><div id="highlighter_219534"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div>1</div><p></p><div>2</div><p></p><div>3</div><p></p><div>4</div><p></p><div>5</div><p></p><div>6</div><p></p><div>7</div></td><td><div><div><code>[proftpd]</code></div><p></p><div></div><p></p><div><code>enabled  = false</code></div><p></p><div><code>port     = ftp</code></div><p></p><div><code>filter   = proftpd</code></div><p></p><div><code>logpath  = /var/proftpd/proftp.log</code></div><p></p><div><code>maxretry = 6</code></div></div></td></tr></tbody></table></div></div><p>изменим на</p><div><div id="highlighter_125568"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div>1</div><p></p><div>2</div><p></p><div>3</div><p></p><div>4</div><p></p><div>5</div><p></p><div>6</div><p></p><div>7</div></td><td><div><div><code>[proftpd]</code></div><p></p><div></div><p></p><div><code>enabled  = true</code></div><p></p><div><code>port     = ftp</code></div><p></p><div><code>filter   = proftpd</code></div><p></p><div><code>logpath  = /var/log/auth.log</code></div><p></p><div><code>maxretry = 3</code></div></div></td></tr></tbody></table></div></div><h3>Другие настройки</h3><p></p><ul><li>ignoreip - это разделенный пробелами список ip-адресов, которые не могут быть блокированы fail2ban. Сюда можно занести свою локальную машину или комьютер, с которого будут проводится эксперименты над системой</li><li>bantime - время в секунда, на которое блокируется хост.</li><li>maxretry - максимальное число ошибочных попыток доступа к сервису, прежде чем хост будет заблокирован fail2ban.</li><li>filter - имя соответствующего файла-фильтра в /etc/fail2ban/filter.d, без конечного <em>.conf</em></li><li>action - имя соответствующего файла-реакции на срабатывание фильтра в /etc/fail2ban/action.d</li><li>logpath - файл логов, мониторинг которого осуществляет fail2ban, для проверки попыток атак.</li><li>enabled - может принимать значение true или false. Включено,выключено правило.</li></ul><p>Поставив, достаточно простое средство, fail2ban вы увидите значительное сокращение log-файлов.</p><footer><div class="content__tag-share"><ul class="content__tag"><li><a href="https://petrukmax.github.io/guideto/tags/apache/">Apache</a></li></ul><div class="content__share"></div></div><div class="content__bio"><h3><a href="https://petrukmax.github.io/guideto/authors/admin/" title="GUIDETO">GUIDETO</a></h3></div></footer></div></div></article><div class="main__right main__right--bottom"><div class="related"><h2 class="related__title">Related posts:</h2><ul class="related__items"><li class="related__item"><h3 class="h5"><a href="https://petrukmax.github.io/guideto/feedburner-nastroyka-rss-schetchik-feedburner-i-podpiska-po-e-mail.html">Feedburner — настройка RSS, счетчик Feedburner и подписка по E-mail</a></h3></li><li class="related__item"><h3 class="h5"><a href="https://petrukmax.github.io/guideto/fail2ban-asterisk-18-banim-pravilno.html">fail2ban + Asterisk 1.8 баним правильно</a></h3></li><li class="related__item"><h3 class="h5"><a href="https://petrukmax.github.io/guideto/test-skorosti-apache.html">Тест скорости Apache</a></h3></li></ul></div></div></main><footer class="footer"><div class="footer__copyright">Powered by Publii</div></footer></div></div><script defer="defer" src="https://petrukmax.github.io/guideto/assets/js/scripts.min.js?v=1ea8317abae2e05fa2a65ed7bbff7ba7"></script><script>var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }</script></body></html>
<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Fail2ban настройка для ssh apache - Blog</title><meta name="description" content="Всегда есть ненулевая вероятность, что где-нибудь кто-нибудь выберет не столь сложный и надежный пароль, который злоумышленник сможет подобрать простым перебором.Для защиты от такого подбора пароля (такую атаку часто называют брутфорсом - см. Полный перебор) есть удачное и изящное решение - fail2ban. Этот пакет есть в репозиториях, и базовая установка очень проста:sudo apt-get install fail2ban"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="http://4o1.ru/fail2ban-nastroyka-dlya-ssh-apache.html"><link rel="alternate" type="application/atom+xml" href="http://4o1.ru/feed.xml"><link rel="alternate" type="application/json" href="http://4o1.ru/feed.json"><meta property="og:title" content="Fail2ban настройка для ssh apache"><meta property="og:site_name" content="Blog"><meta property="og:description" content="Всегда есть ненулевая вероятность, что где-нибудь кто-нибудь выберет не столь сложный и надежный пароль, который злоумышленник сможет подобрать простым перебором.Для защиты от такого подбора пароля (такую атаку часто называют брутфорсом - см. Полный перебор) есть удачное и изящное решение - fail2ban. Этот пакет есть в репозиториях, и базовая установка очень проста:sudo apt-get install fail2ban"><meta property="og:url" content="http://4o1.ru/fail2ban-nastroyka-dlya-ssh-apache.html"><meta property="og:type" content="article"><link rel="stylesheet" href="http://4o1.ru/assets/css/fontawesome-all.min.css?v=85514f933f9e0b82460af63f1a403fa5"><link rel="stylesheet" href="http://4o1.ru/assets/css/style.css?v=9274fb62a8095432057114afc1a7f7fc"><noscript><link rel="stylesheet" href="http://4o1.ru/assets/css/noscript.css?v=efa867a99f5064d6729e4dc2008ad50b"></noscript><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"http://4o1.ru/fail2ban-nastroyka-dlya-ssh-apache.html"},"headline":"Fail2ban настройка для ssh apache","datePublished":"2013-02-28T13:26+04:00","dateModified":"2024-08-19T17:47+03:00","description":"Всегда есть ненулевая вероятность, что где-нибудь кто-нибудь выберет не столь сложный и надежный пароль, который злоумышленник сможет подобрать простым перебором.Для защиты от такого подбора пароля (такую атаку часто называют брутфорсом - см. Полный перебор) есть удачное и изящное решение - fail2ban. Этот пакет есть в репозиториях, и базовая установка очень проста:sudo apt-get install fail2ban","author":{"@type":"Person","name":"GUIDETO","url":"http://4o1.ru/authors/admin/"},"publisher":{"@type":"Organization","name":"GUIDETO"}}</script><style>#wrapper > .bg {
               background-image: url(http://4o1.ru/assets/images/overlay.png), linear-gradient(0deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)), url();
           }</style><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="is-preload post-template"><div id="wrapper"><header id="header"><a class="logo" href="http://4o1.ru/">Blog</a></header><nav id="nav"><ul class="links"><li><a href="http://4o1.ru/tags/kouching/" target="_self">Коучинг</a></li><li><a href="http://4o1.ru/tags/psixologiya/" target="_self">Психология</a></li><li><a href="http://4o1.ru/tags/knigi/" target="_self">Книги</a></li><li><a href="http://4o1.ru/tags/video/" target="_self">Видео</a></li><li><a href="http://4o1.ru/tags/biz/" target="_self">Бизнес</a></li><li><a href="http://4o1.ru/tags/bez-rubriki/" target="_self">Без рубрики</a></li><li><a href="http://4o1.ru/tags/audiobook/" target="_self">Аудиокниги</a></li><li><a href="http://4o1.ru/tags/anglijskij/" target="_self">Английский</a></li><li class="has-submenu"><a href="http://4o1.ru/tags/it/" target="_self" aria-haspopup="true">IT</a><ul class="nav__submenu level-2" aria-hidden="true"><li><a href="http://4o1.ru/tags/wordpress/" target="_self">WordPress</a></li><li><a href="http://4o1.ru/tags/seo/" target="_self">SEO</a></li><li class="has-submenu"><a href="http://4o1.ru/tags/yazyki/" target="_self" aria-haspopup="true">Языки</a><ul class="nav__submenu level-3" aria-hidden="true"><li><a href="http://4o1.ru/tags/html/" target="_self">HTML</a></li><li><a href="http://4o1.ru/tags/php/" target="_self">PHP</a></li></ul></li><li><a href="http://4o1.ru/tags/hard/" target="_self">Железо</a></li><li><a href="http://4o1.ru/tags/android/" target="_self">Android</a></li><li class="has-submenu"><a href="http://4o1.ru/tags/windows/" target="_self" aria-haspopup="true">Windows</a><ul class="nav__submenu level-3" aria-hidden="true"><li><a href="http://4o1.ru/tags/iis/" target="_self">IIS</a></li></ul></li><li class="has-submenu"><a href="http://4o1.ru/tags/unix/" target="_self" aria-haspopup="true">Unix</a><ul class="nav__submenu level-3" aria-hidden="true"><li><a href="http://4o1.ru/tags/apache/" target="_self">Apache</a></li><li><a href="http://4o1.ru/tags/asterisk/" target="_self">Asterisk</a></li></ul></li></ul></li></ul></nav><main id="main"><article class="post"><header class="major"><time datetime="2013-02-28T13:26" class="date">февраль 28, 2013</time><h1>Fail2ban настройка для ssh apache</h1><p class="post__inner"></p></header><div class="post__inner post__entry"><p>Всегда есть ненулевая вероятность, что где-нибудь кто-нибудь выберет не столь сложный и надежный пароль, который злоумышленник сможет подобрать простым перебором.</p><p>Для защиты от такого подбора пароля (такую атаку часто называют брутфорсом - см. Полный перебор) есть удачное и изящное решение - fail2ban. Этот пакет есть в репозиториях, и базовая установка очень проста:</p><pre>sudo apt-get install fail2ban</pre><p></p><p>В состоянии сразу после установки (во всяком случае, в 10.04) защита от брутфорса по SSH включена.</p><p>Основная идея - при превышении заданного числа неудачных вводов пароля подряд (по умолчанию - 6) бан IP, с которого были попытки подбора на заданное время (по умолчанию - 600 секунд).</p><p>Параметры можно посмотреть и поменять в файле <code>/etc/fail2ban/jail.conf</code>. Существующие фильтры (т.е. правила, по которым определяется неудачная попытка ввода пароля) лежат в директории <code>/etc/fail2ban/filter.d/</code> (можно их править или на их основе делать свои фильтры), а существующие правила реагирования - в директории<code>/etc/fail2ban/action.d/</code></p><p>заглянем-ка в файл протокола ошибок apache (<strong>/var/log/httpd/error_log</strong>):</p><pre>[Sat Jan 31 12:05:49 2009] [error] [client 89.18.176.83] <strong>File does not exist</strong>: /var/www/html/bin<restore-line-break><restore-line-break>[Sat Jan 31 12:05:50 2009] [error] [client 89.18.176.83] <strong>File does not exist</strong>: /var/www/html/mail<restore-line-break><restore-line-break>[Sat Jan 31 12:05:52 2009] [error] [client 89.18.176.83] <strong>File does not exist</strong>: /var/www/html/webmail<restore-line-break><restore-line-break>[Sat Jan 31 12:05:53 2009] [error] [client 89.18.176.83] <strong>File does not exist</strong>: /var/www/html/roundcube<restore-line-break><restore-line-break>[Sat Jan 31 12:05:58 2009] [error] [client 89.18.176.83] <strong>File does not exist</strong>: /var/www/html/rc</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p>Насколько я понимаю, данные строки лога показывают, что «некто» пытается найти в моем сервере «нечто». Не знаю, можете называть это паранойей, но мне это очень не нравится! А вдруг найдет? Или вот еще, к примеру, строка из лога:</p><pre>[Mon Jan 26 22:19:46 2009] [error] [client 213.21.37.175] script '/var/www/html/azenv.php' not found or unable to stat</pre><p>Может это самый лучший и самый полезный в мире скрипт, а может быть и нет. Как по мне, так лучше не надо!</p><p>Итак, решено — будем защищаться. fail2ban у меня уже установлен — ssh защищает. Но это далеко не единственная возможность программы. Просто по умолчанию сразу после установки в ней включен единственный фильтр — <strong>sshd.conf</strong>. Вернемся к сути программы fail2ban. Она постоянно анализирует файлы протоколов работы служб компьютера, пытаясь найти в них сообщения об ошибках, соответствующие установленным шаблонам. Если условие совпадает, программа выполняет указанное действие. Условия-шаблоны прописываются в файлах фильтров, расположенных в папке <strong>/etc/fail2ban/filter.d</strong>. Возможные действия представлены файлами, находящимися в папке <strong>/etc/fail2ban/action.d</strong>. Управление «включением» и «выключением» фильтров, а также выбор последующих «действий» осуществляется в файле настроек <strong>/etc/fail2ban/jail.conf</strong>. Борьбу за безопасность apache я начал с поиска подходящего фильтра в папке<strong> /etc/fail2ban/filter.d</strong>. На первый взгляд мне подошел файл фильтра <strong>apache-noscript.conf</strong>. Его я поначалу и задействовал (об этом ниже). Однако, впоследствии, сопоставляя файл протокола ошибок apache и файл протокола работы fail2ban, я заметил, что далеко не все сообщения об ошибках приводят к бану вызвавших их посетителей. Утверждать, что программа не работает, было бы неправдой — на часть ошибок она все-таки реагировала. Следовательно, «что-то не то» с шаблонами. Отличным подспорьем в «разборках» с шаблонами является программа <strong>fail2ban-regex</strong>, устанавливаемая на компьютер вместе с fail2ban. Программа позволяет проанализировать указанный лог (или просто текстовую строку) на предмет нахождения соответствий шаблону из файла фильтра (или просто текстовой строке). Именно этим я и занялся. Взял лог, взял фильтр и «скормил» их програмке — ввел в консоли команду:</p><blockquote><tt><strong>fail2ban-regex /var/log/httpd/error_log apache-noscript.conf</strong></tt></blockquote><p>Первый ответ, о том, что найдено аж 10 совпадений меня очень развеселил.  »Невооруженным глазом» было видно, что в логе их гораздо больше… И начал я подбирать шаблон, попутно проверяя его эффективность все той же приведенной выше командой. Число совпадений росло, сначала три сотни, потом больше тысячи, финальный результат был равен 1706. Я решил, что пока хватит, а дальше посмотрим. Теперь о произведенных мной изменениях. Изначально в файле фильтра <strong>apache-noscript.conf </strong>строка шаблона сообщения об ошибке выглядела так:</p><pre>failregex = [[]client <host>[]] (File does not exist|script not found or unable to stat): .*(\.php|\.asp|\.exe|\.pl)</host></pre><p>Результат, который в конце концов устроил лично меня, выглядит так:</p><pre>failregex = [[]client <host>[]] (File does not exist|Invalid URI in request|.* not found or unable to stat)</host></pre><p>В чем суть моих изменений? Во первых, оригинальная строка шаблона предполагает, что в логе сообщение об ошибке должно содержать что-либо из «.php», «.asp», «.exe» или «.pl». Если же в строке такого нет, шаблон не срабатывает. Но даже в той «нарезке» лога apache, что я привел выше мы видим, что нет там никаких «.php», «.asp», «.exe» или «.pl». Следовательно фильтр не сработает. По этому, окончание шаблона — (\.php|\.asp|\.exe|\.pl) — я попросту выкинул.</p><p>Ну и во вторых, та часть шаблона, которая вылавливает неправильные скрипты. В оригинале она хочет, чтобы в логе был такой текст «<strong><em>script not found or unable to stat</em></strong>» (одним непрерывным куском!!!). Но, посмотрев в свои логи я увидел, что зачастую там текст отформатирован иначе, например так: «script ‘/var/www/html/pt.php’ not found or unable to stat». Следовательно этот фильтр тоже не срабатывал бы. Пришлось его заменить на «<strong><em>.* not found or unable to stat</em></strong>«. В данном случае «<strong>.*</strong>» обозначает «любой текст». После этого фильтр начал срабатывать на сообщения об ошибках о запуске несуществующих скриптов.</p><p>Кстати, дополнительно почитать о «регулярных выражениях» или попросту говоря, шаблонах, можно по ссылке:</p><p>http://www.amk.ca/python/howto/regex/regex.html</p><p>Ну и вкратце о том, как я подключал фильтр. В файле настроек <strong>/etc/fail2ban/jail.conf</strong> я нашел раздел:</p><blockquote><pre>[apache-shorewall]<restore-line-break><restore-line-break><restore-line-break><restore-line-break>enabled  = false<restore-line-break><restore-line-break>filter   = apache-noscript<restore-line-break><restore-line-break>action   = shorewall<restore-line-break><restore-line-break>           sendmail[name=Postfix, dest=you@mail.com]<restore-line-break><restore-line-break>logpath  = /var/log/apache2/error_log</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre></blockquote><p>И изменил его следующим образом:</p><blockquote><pre>[apache-shorewall]<restore-line-break><restore-line-break><restore-line-break><restore-line-break>enabled  = true<restore-line-break><restore-line-break>filter   = apache-noscript<restore-line-break><restore-line-break>action   = shorewall<restore-line-break><restore-line-break>           mail-whois[name=Apache, dest=dmitry@my-svr]<restore-line-break><restore-line-break>logpath  = /var/log/httpd/error_log<restore-line-break><restore-line-break>maxretry = 2</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre></blockquote><p>Таким образом я:</p><ul><li>включил (<strong>enabled = true</strong>)…</li><li>выбранный фильтр (<strong>filter = apache-noscript</strong>)…</li><li>на анализ файла протокола (<strong>logpath = /var/log/httpd/error_log</strong>)…</li><li>и при возникновении 2 ошибок (<strong>maxretry = 2</strong>)…</li><li>доступ блокируется при помощи файервола (<strong>action = shorewall</strong>).</li></ul><p>Вот и все…</p><p>P.S.</p><p>Не вышло «все», однако… 21 марта с одного IP такой «вал валил», что я решил предпринять что-то. И нашел еще один фильтр — <strong>apache-overflows.conf</strong>, который вроде как очень подходил моим потребностям. Судите сами, вот кусок лога apache:</p><pre>[Sat Mar 21 17:19:35 2009] [error] [client 221.223.93.132] Invalid method in request \xf0\xaf\xa0_\x98\x1b\x9fi\xe2\x84\xca\xc8\xca\xfa\xabA\xb4f\xe0+\xf3\x96>S\x90\x90\xc1D\x80\xc2\x11\xe17\xcc\x91\x97<restore-line-break><restore-line-break>[Sat Mar 21 17:20:04 2009] [error] [client 221.223.93.132] Invalid URI in request \xfb%\xd2\ba\xf5\x84\x9c'\x0c\xbc\xf4|\xffu\x10?\xf2\x96\xee\xda\x9d\xe9\x9f\xb0\x15\xc9\xe9nd<restore-line-break><restore-line-break>[Sat Mar 21 17:20:43 2009] [error] [client 221.223.93.132] request failed: error reading the headers</restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p>А вот (но, правда, уже немножко подкорректированный мной) фильтр:</p><pre># Notes.:  Regexp to catch Apache overflow attempts.<restore-line-break><restore-line-break># Values:  TEXT<restore-line-break><restore-line-break>#<restore-line-break><restore-line-break>failregex = [[]client []] (Invalid method in request|Invalid URI in request|request failed: URI too long|request failed: error reading the headers|erroneous characters after protocol string).*<restore-line-break><restore-line-break><restore-line-break><restore-line-break># Option:  ignoreregex<restore-line-break><restore-line-break># Notes.:  regex to ignore. If this regex matches, the line is ignored.<restore-line-break><restore-line-break># Values:  TEXT<restore-line-break><restore-line-break>#<restore-line-break><restore-line-break>ignoreregex =</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p>Пришлось и его включать. С поправкой на тот факт, что мне показалось, что это была именно атака, рубить доступ я решил с первой же попытки. Для этого в файл <strong>/etc/fail2ban/jail.conf</strong> я добавил следующие строки:</p><pre>[apache-overflow]<restore-line-break><restore-line-break>enabled	= true<restore-line-break><restore-line-break>filter	= apache-overflows<restore-line-break><restore-line-break>action	= shorewall<restore-line-break><restore-line-break>logpath	= /var/log/httpd/error_log<restore-line-break><restore-line-break>maxretry = 1</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre><p>После этого перезапустил fail2ban командой:</p><blockquote><strong><code>fail2ban-client reload</code></strong></blockquote><p>И вот теперь сижу и жду новых поводов для добавления новых фильтров…</p><p>я описал пару фильтров, используемых мной для предотвращения «вражеских» происков, направленных против моего <strong>apache</strong>. Работало все это отлично, и вопросов не возникало. И дальше бы работало, если бы меня не потянуло на разборки с <strong>Chillispot</strong>. Дело в том, что в описанных мной конфигурациях <strong>fail2ban </strong>блокирование нежелательного доступа осуществляется при помощи <strong>shorewall</strong>. А его-то я как раз и поломал, ковыряясь с <strong>Chillispot</strong>. Точнее, не поломал, а отключил, так как для работы <strong>Chillispot</strong> требуется загрузка своего собственого скрипта с правилами для<strong>iptables</strong>, который «множит на ноль» всю работу <strong>shorewall</strong>…</p><p>Чтож, iptables, так iptables. Нам-то какая разница!? Нужно всего-лишь заставить <strong>fail2ban </strong>тоже использовать <strong>iptables</strong> при блокировании доступа. Для этого залез я в файл <strong>/etc/fail2ban/jail.conf</strong> и настройки «тюрем» своих поисправлял следующим образом:</p><blockquote><pre>[apache-shorewall]<restore-line-break><restore-line-break><restore-line-break><restore-line-break>enabled  = true<restore-line-break><restore-line-break>filter   = apache-noscript<restore-line-break><restore-line-break><strong>action = iptables[name=httpd, port=http, protocol=tcp]</strong><restore-line-break><restore-line-break>logpath  = /var/log/httpd/error_log<restore-line-break><restore-line-break>maxretry = 2</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre></blockquote><p>И второй «тюрьме» тоже:</p><blockquote><pre>[apache-overflow]<restore-line-break><restore-line-break>enabled	= true<restore-line-break><restore-line-break>filter	= apache-overflows<restore-line-break><restore-line-break><strong>action = iptables[name=httpd, port=http, protocol=tcp]</strong><restore-line-break><restore-line-break>logpath	= /var/log/httpd/error_log<restore-line-break><restore-line-break>maxretry = 1</restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></pre></blockquote><p>Изменения по сравнению с предыдущим вариантом, описанным мной ранее, для наглядности я выделил красным цветом. Также, если сравнить с предыдущими вариантами, я не стал писать строку со вторым «действием» (action) — отправку письма администратору (mail-whois или sendmail). Ему (мне) и так писем достаточно… Названия самих «тюрем» (те, что в указанных примерах написаны в квадратных скобках) я менять не стал. Они все равно ни на что не влияют, только лишь в лог пишутся.</p><p>После внесения указанных изменений перезапустил fail2ban командой:</p><blockquote><strong><code>fail2ban-client reload</code></strong></blockquote><p>И все! Кстати, есть еще одно отличие у данного варианта блокирования по сравнению с <strong>shorewall</strong>, описанным ранее: <strong>iptables</strong> блокирует только порт<strong>apache</strong>…</p><p>&nbsp;</p><h2>Настройка Fail2ban на Debian</h2><p><strong>Fail2ban</strong> - отслеживает IP адреса с которых производились неудачные повторяющиеся попытки получить доступ по какому-либо из сервисов (SSH, FTP, SMTP, Apache) сервера в файлах журналов.</p><h3><span style="text-decoration: underline;">Установка</span></h3><p>из под root`а выполним:</p><div><div id="highlighter_605274"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div><div><code>aptitude</code><code>install</code> <code>fail2ban</code></div></div></td></tr></tbody></table></div></div><p>После установки Вы можете настроить fail2ban с помощью этих двух файлов, расположенных в /etc/fail2ban/</p><div><div id="highlighter_747957"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div><div><code>/etc/fail2ban/fail2ban</code><code>.conf</code></div><p></p><div><code>/etc/fail2ban/jail</code><code>.conf</code></div></div></td></tr></tbody></table></div></div><p>Откроем jail.conf, что бы включить отслеживание сервисов.</p><div><div id="highlighter_150219"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div><div><code>nano</code><code>/etc/fail2ban/jail</code><code>.conf</code></div></div></td></tr></tbody></table></div></div><p>Теперь можем включить или выключить нужные сервисы.</p><p>По умолчанию отслеживание SSH включено.</p><p>Если Вы хотите добавить отслеживание Apache измените:</p><div><div id="highlighter_183791"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div>1</div><p></p><div>2</div><p></p><div>3</div><p></p><div>4</div><p></p><div>5</div><p></p><div>6</div><p></p><div>7</div><p></p><div>8</div><p></p><div>9</div><p></p><div>10</div><p></p><div>11</div></td><td><div><div><code>#</code></div><p></p><div><code># HTTP servers</code></div><p></p><div><code>#</code></div><p></p><div></div><p></p><div><code>[apache]</code></div><p></p><div></div><p></p><div><code>enabled = false</code></div><p></p><div><code>port    = http</code></div><p></p><div><code>filter  = apache-auth</code></div><p></p><div><code>logpath = /var/log/apache*/*access.log</code></div><p></p><div><code>maxretry = 6</code></div></div></td></tr></tbody></table></div></div><p>на:</p><div><div id="highlighter_126665"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div>1</div><p></p><div>2</div><p></p><div>3</div><p></p><div>4</div><p></p><div>5</div><p></p><div>6</div><p></p><div>7</div><p></p><div>8</div><p></p><div>9</div><p></p><div>10</div><p></p><div>11</div></td><td><div><div><code>#</code></div><p></p><div><code># HTTP servers</code></div><p></p><div><code>#</code></div><p></p><div></div><p></p><div><code>[apache]</code></div><p></p><div></div><p></p><div><code>enabled = true</code></div><p></p><div><code>port    = http</code></div><p></p><div><code>filter  = apache-auth</code></div><p></p><div><code>logpath = /var/log/apache2/*access.log</code></div><p></p><div><code>maxretry = 6</code></div></div></td></tr></tbody></table></div></div><p>Для FTP (proftpd)</p><div><div id="highlighter_219534"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div>1</div><p></p><div>2</div><p></p><div>3</div><p></p><div>4</div><p></p><div>5</div><p></p><div>6</div><p></p><div>7</div></td><td><div><div><code>[proftpd]</code></div><p></p><div></div><p></p><div><code>enabled  = false</code></div><p></p><div><code>port     = ftp</code></div><p></p><div><code>filter   = proftpd</code></div><p></p><div><code>logpath  = /var/proftpd/proftp.log</code></div><p></p><div><code>maxretry = 6</code></div></div></td></tr></tbody></table></div></div><p>изменим на</p><div><div id="highlighter_125568"><div>?</div><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><div>1</div><p></p><div>2</div><p></p><div>3</div><p></p><div>4</div><p></p><div>5</div><p></p><div>6</div><p></p><div>7</div></td><td><div><div><code>[proftpd]</code></div><p></p><div></div><p></p><div><code>enabled  = true</code></div><p></p><div><code>port     = ftp</code></div><p></p><div><code>filter   = proftpd</code></div><p></p><div><code>logpath  = /var/log/auth.log</code></div><p></p><div><code>maxretry = 3</code></div></div></td></tr></tbody></table></div></div><h3>Другие настройки</h3><p></p><ul><li>ignoreip - это разделенный пробелами список ip-адресов, которые не могут быть блокированы fail2ban. Сюда можно занести свою локальную машину или комьютер, с которого будут проводится эксперименты над системой</li><li>bantime - время в секунда, на которое блокируется хост.</li><li>maxretry - максимальное число ошибочных попыток доступа к сервису, прежде чем хост будет заблокирован fail2ban.</li><li>filter - имя соответствующего файла-фильтра в /etc/fail2ban/filter.d, без конечного <em>.conf</em></li><li>action - имя соответствующего файла-реакции на срабатывание фильтра в /etc/fail2ban/action.d</li><li>logpath - файл логов, мониторинг которого осуществляет fail2ban, для проверки попыток атак.</li><li>enabled - может принимать значение true или false. Включено,выключено правило.</li></ul><p>Поставив, достаточно простое средство, fail2ban вы увидите значительное сокращение log-файлов.</p></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on август 19, 2024</p><div class="post__share-tag-container"><div class="post__tag"><h3>Tagged in:</h3><ul><li><a href="http://4o1.ru/tags/apache/">Apache</a></li></ul></div><div class="post__share"><button class="post__share-button js-post__share-button icon" aria-label="Share button"><i class="fas fa-share-alt"></i></button><div class="post__share-popup js-post__share-popup"></div></div></div><div class="post__bio"><div><h3><a href="http://4o1.ru/authors/admin/" class="invert" rel="author">GUIDETO</a></h3></div></div></footer></article><div><strong>You should also read:</strong></div><div class="posts"><article><header><time datetime="2013-05-22T12:41" class="date">май 22, 2013</time><h2><a href="http://4o1.ru/feedburner-nastroyka-rss-schetchik-feedburner-i-podpiska-po-e-mail.html">Feedburner — настройка RSS, счетчик Feedburner и подписка по E-mail</a></h2></header><p></p><p>Это очередная статья из рубрики RSS лента для сайта, Feedburner, где мы продолжим разговор об RSS лентах, каналах и новостях, начатый статье рассказывающей что такое RSS. Сегодня мы поговорим о<strong>Feedburner</strong> и о том, что с ним связано. Настроим трансляцию нашего feed (RSS ленты) через Feedburner, предложим посетителям сайта подписываться на RSS ленту посредством E-mail, получим код <em>счетчика FeedBurner</em>, который будет считать количество подписчиков на вашу новостную ленту.</p><div><img loading="lazy" src="http://4o1.ru/media/posts/92/feedburner.jpg" alt="" width="500" height="226" sizes="(max-width: 48em) 100vw, 768px" srcset="http://4o1.ru/media/posts/92/responsive/feedburner-xs.jpg 300w, http://4o1.ru/media/posts/92/responsive/feedburner-sm.jpg 480w, http://4o1.ru/media/posts/92/responsive/feedburner-md.jpg 768w, http://4o1.ru/media/posts/92/responsive/feedburner-lg.jpg 1024w, http://4o1.ru/media/posts/92/responsive/feedburner-xl.jpg 1360w, http://4o1.ru/media/posts/92/responsive/feedburner-2xl.jpg 1600w"></div><p></p><p></p><ul class="actions special"><li><a href="http://4o1.ru/feedburner-nastroyka-rss-schetchik-feedburner-i-podpiska-po-e-mail.html" class="button">Full Story</a></li></ul></article><article><header><time datetime="2013-02-28T14:30" class="date">февраль 28, 2013</time><h2><a href="http://4o1.ru/fail2ban-asterisk-18-banim-pravilno.html">fail2ban + Asterisk 1.8 баним правильно</a></h2></header><p></p><p>В связи с открытием нового филиала в маленьком городе Екатеринбурге,потребовалось настроить связь с главным офисом, для этого на платформе Intel Atom были подняты сервисы: Samba4 как PDC,Squid,Asterisk. Так как это небольшая заметка, то остановимся на конкретном вопросе защиты Asterisk'a.</p><p>Из исходников был поставлен asterisk 1.8.5, который собрался без проблем. Понравилось то, что в отличии от версии 1.6, в версии 1.8 в исходники входит asterisk-addons, что немного уменьшает количество телодвижений при установке. Особых отличий в настройке для 1.8 не было замечено, конфиги (sip.conf,logger.conf,extensions.conf) из asterisk 1.6 перенеслись без проблем. Но вот на этапе защиты от перебора паролей возникли некоторые сложности!</p><p></p><ul class="actions special"><li><a href="http://4o1.ru/fail2ban-asterisk-18-banim-pravilno.html" class="button">Full Story</a></li></ul></article><article><header><time datetime="2013-02-04T22:48" class="date">февраль 4, 2013</time><h2><a href="http://4o1.ru/test-skorosti-apache.html">Тест скорости Apache</a></h2></header><p>Самый лучший tool для тестинга идет вместе с apache. Он же прекрасный DOSер, но почему-то все это забывают. называется ab tool. Запускается так:&hellip;</p><ul class="actions special"><li><a href="http://4o1.ru/test-skorosti-apache.html" class="button">Full Story</a></li></ul></article><article><header><time datetime="2012-10-03T14:13" class="date">октябрь 3, 2012</time><h2><a href="http://4o1.ru/nastraivaem-svyazku-apache2-mod_wsgi-django-pod-ubuntu-centos.html">Настраиваем связку apache2, mod_wsgi, django под ubuntu, centos</a></h2></header><p></p><p>В этом посте опишу последовательность шагов для установки связки <strong>apache2</strong>,<strong>mod_wsgi 3.2</strong>, <strong>django 1.1</strong> под <strong>ubuntu 9.10</strong> и <strong>centos 5.4</strong>.</p><p><strong>Под ubuntu 9.10</strong></p><p><strong>Ставим apache2</strong></p><p>Устанавливаем apache2 и сопутствующие модули:</p><pre data-result="[object Object]">sudo apt-get install apache2 apache2.2-common apache2-mpm-prefork apache2-utils libexpat1 ssl-cert build-essential</pre><p></p><p></p><ul class="actions special"><li><a href="http://4o1.ru/nastraivaem-svyazku-apache2-mod_wsgi-django-pod-ubuntu-centos.html" class="button">Full Story</a></li></ul></article></div></main><footer id="copyright"><ul><li>&copy; Massively</li><li>Design: <a href="https://html5up.net" target="_blank" rel="nofollow noopener">HTML5 UP</a></li><li>Powered by Publii</li></ul></footer></div><script src="http://4o1.ru/assets/js/jquery.min.js?v=c9771cc3e90e18f5336eedbd0fffb2cf"></script><script src="http://4o1.ru/assets/js/jquery.scrollex.min.js?v=f89065e3d988006af9791b44561d7c90"></script><script src="http://4o1.ru/assets/js/jquery.scrolly.min.js?v=1ed5a78bde1476875a40f6b9ff44fc14"></script><script src="http://4o1.ru/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="http://4o1.ru/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="http://4o1.ru/assets/js/util.min.js?v=4201a626f8c9b614a663b3a1d7d82615"></script><script src="http://4o1.ru/assets/js/main.min.js?v=56233c354bd814758be8bff42f7e13a5"></script><script>/*<![CDATA[*/var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};/*]]>*/</script></body></html>
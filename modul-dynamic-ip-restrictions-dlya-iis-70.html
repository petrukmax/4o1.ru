<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Модуль Dynamic IP Restrictions для IIS 7.0 - Blog</title><meta name="description" content="IIS Team выпустила бета-версию расширения Dynamic IP Restrictions.  Расширение позволяет блокировать IP адреса по количеству одновременных запросов, по количеству запросов в единицу времени, журналировать все отвергнутые запросы, а также поддерживает IPv6."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="http://blog.tvojdrug.ru/modul-dynamic-ip-restrictions-dlya-iis-70.html"><link rel="alternate" type="application/atom+xml" href="http://blog.tvojdrug.ru/feed.xml"><link rel="alternate" type="application/json" href="http://blog.tvojdrug.ru/feed.json"><meta property="og:title" content="Модуль Dynamic IP Restrictions для IIS 7.0"><meta property="og:site_name" content="Blog"><meta property="og:description" content="IIS Team выпустила бета-версию расширения Dynamic IP Restrictions.  Расширение позволяет блокировать IP адреса по количеству одновременных запросов, по количеству запросов в единицу времени, журналировать все отвергнутые запросы, а также поддерживает IPv6."><meta property="og:url" content="http://blog.tvojdrug.ru/modul-dynamic-ip-restrictions-dlya-iis-70.html"><meta property="og:type" content="article"><link rel="stylesheet" href="http://blog.tvojdrug.ru/assets/css/style.css?v=984cc9f9fa9fd7a0b9529b5c6d9033e9"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.tvojdrug.ru/modul-dynamic-ip-restrictions-dlya-iis-70.html"},"headline":"Модуль Dynamic IP Restrictions для IIS 7.0","datePublished":"2013-03-06T16:06","dateModified":"2024-08-19T17:47","description":"IIS Team выпустила бета-версию расширения Dynamic IP Restrictions.  Расширение позволяет блокировать IP адреса по количеству одновременных запросов, по количеству запросов в единицу времени, журналировать все отвергнутые запросы, а также поддерживает IPv6.","author":{"@type":"Person","name":"GUIDETO","url":"http://blog.tvojdrug.ru/authors/admin/"},"publisher":{"@type":"Organization","name":"GUIDETO"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container js-container"><nav class="menu"><ul class="navbar__menu"><li><a href="http://blog.tvojdrug.ru/tags/kouching/" target="_self">Коучинг</a></li><li><a href="http://blog.tvojdrug.ru/tags/psixologiya/" target="_self">Психология</a></li><li><a href="http://blog.tvojdrug.ru/tags/knigi/" target="_self">Книги</a></li><li><a href="http://blog.tvojdrug.ru/tags/video/" target="_self">Видео</a></li><li><a href="http://blog.tvojdrug.ru/tags/biz/" target="_self">Бизнес</a></li><li><a href="http://blog.tvojdrug.ru/tags/bez-rubriki/" target="_self">Без рубрики</a></li><li><a href="http://blog.tvojdrug.ru/tags/audiobook/" target="_self">Аудиокниги</a></li><li><a href="http://blog.tvojdrug.ru/tags/anglijskij/" target="_self">Английский</a></li><li class="has-submenu"><a href="http://blog.tvojdrug.ru/tags/it/" target="_self">IT</a><ul class="navbar__submenu"><li><a href="http://blog.tvojdrug.ru/tags/wordpress/" target="_self">WordPress</a></li><li><a href="http://blog.tvojdrug.ru/tags/seo/" target="_self">SEO</a></li><li class="has-submenu"><a href="http://blog.tvojdrug.ru/tags/yazyki/" target="_self">Языки</a><ul class="navbar__submenu"><li><a href="http://blog.tvojdrug.ru/tags/html/" target="_self">HTML</a></li><li><a href="http://blog.tvojdrug.ru/tags/php/" target="_self">PHP</a></li></ul></li><li><a href="http://blog.tvojdrug.ru/tags/hard/" target="_self">Железо</a></li><li><a href="http://blog.tvojdrug.ru/tags/android/" target="_self">Android</a></li><li class="has-submenu"><a href="http://blog.tvojdrug.ru/tags/windows/" target="_self">Windows</a><ul class="navbar__submenu"><li><a href="http://blog.tvojdrug.ru/tags/iis/" target="_self">IIS</a></li></ul></li><li class="has-submenu"><a href="http://blog.tvojdrug.ru/tags/unix/" target="_self">Unix</a><ul class="navbar__submenu"><li><a href="http://blog.tvojdrug.ru/tags/apache/" target="_self">Apache</a></li><li><a href="http://blog.tvojdrug.ru/tags/asterisk/" target="_self">Asterisk</a></li></ul></li></ul></li></ul></nav><div class="container__content"><header class="top"><div class="top__item"><a class="logo" href="http://blog.tvojdrug.ru/">Blog</a></div><div class="top__item top__item--right"><button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false"><span class="menu-toggle-box"><span class="menu-toggle-inner">Menu</span></span></button></div></header><main class="main post"><article class="content"><div class="main__left"><figure class="hero"><img src="http://blog.tvojdrug.ru/media/website/111222-4.jpg" srcset="http://blog.tvojdrug.ru/media/website/responsive/111222-4-xs.jpg 300w, http://blog.tvojdrug.ru/media/website/responsive/111222-4-sm.jpg 480w, http://blog.tvojdrug.ru/media/website/responsive/111222-4-md.jpg 768w, http://blog.tvojdrug.ru/media/website/responsive/111222-4-lg.jpg 1024w, http://blog.tvojdrug.ru/media/website/responsive/111222-4-xl.jpg 1280w, http://blog.tvojdrug.ru/media/website/responsive/111222-4-2xl.jpg 1600w" sizes="(min-width: 1800px) 50vw, (min-width: 900px) 40vw, 100vw" loading="eager" width="3840" height="2160" alt=""></figure><header><h1>Модуль Dynamic IP Restrictions для IIS 7.0</h1><p><time datetime="2013-03-06T16:06">март 6, 2013 </time>by <a href="http://blog.tvojdrug.ru/authors/admin/" rel="author" title="GUIDETO">GUIDETO</a></p></header></div><div class="main__right"><div class="content__entry"><p>IIS Team выпустила бета-версию расширения Dynamic IP Restrictions.  Расширение позволяет блокировать IP адреса по количеству одновременных запросов, по количеству запросов в единицу времени, журналировать все отвергнутые запросы, а также поддерживает IPv6.</p><p>Скачать можно <a href="http://blogs.iis.net/ruslany/archive/2009/02/16/dynamic-ip-restrictions-for-iis-7-0-beta.aspx" target="_blank" rel="nofollow">здесь</a>.</p><p>Инструкция по применению находится <a href="http://learn.iis.net/page.aspx/548/using-dynamic-ip-restrictions/" target="_blank" rel="nofollow">здесь</a>.</p><p>Полезный модуль для <strong>IIS</strong> позволяющий немного повысить защиту от грубого подбора паролей и слабеньких <strong>DDoS</strong> атак.</p><h4> Возможности</h4><ul><li>Настраивать модуль можно прямо из менеджера <strong>IIS</strong></li><li>Блокировка IP-адресов на основе одного из следующих критериев:<p></p><ul><li>Кол-во одновременных запросов.</li><li>Кол-во запросов в период времени.</li></ul></li><li>Белый список IP адресов.</li><li>Возможность настройки модуля как для веб-сервера в целом так и для конкретного приложения.</li><li>Возможность выбрать место в которое будет посылаться провинившийся IP адрес.</li><li>Поддержка IPv6.</li><li>Поддержка веб-серверов работающих через прокси-сервер или брандмауэр.</li></ul><h4>Настройка модуля</h4><p>Открываем менеджер <strong>IIS</strong>, находим там <strong>Dynamic IP Restrictions</strong>, открываем его…</p><p><strong>Deny IP addresses based on the number of concurrent requests</strong></p><p><em><strong>Описание:</strong> Кол-во одновременных запросов с одного IP адреса, если от IP адреса приходит больше указанного кол-ва то IP адрес блокируется.</em></p><p><strong>Maximum number of concurrent requests</strong> - Максимальное количество одновременных запросов</p><p><strong>Deny IP addresses based on the number of requests over a period of time</strong></p><p><em><strong>Описание:</strong> Кол-во запросов с одного IP адреса в заданный период времени</em></p><p><strong>Maximum number of requests</strong> — Максимальное кол-во запросов за период времени указанный ниже</p><p><strong>Time period (in milliseconds)</strong> — Временной период (в миллисекундах)</p><p><strong>Other Settings</strong></p><p><strong>Deny Action type</strong> — <em>Куда пересылать запросы с заблокированного IP.</em></p><p><strong>Proxy Mode</strong> — <em>Включить если веб-сервер работает через прокси.</em></p><p><strong>Logging Only Mode</strong> — <em>Только логирование.</em></p><p><img loading="lazy" title="16-11-2012 19-19-24" alt="" src="http://blog.tvojdrug.ru/media/posts/74/16-11-2012-19-19-242.png" width="369" height="415" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/16-11-2012-19-19-242-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/16-11-2012-19-19-242-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/16-11-2012-19-19-242-md.png 768w"></p><p>Скачать <strong>Dynamic IP Restrictions</strong> можно <a title="Dynamic IP Restrictions" href="http://www.iis.net/downloads/microsoft/dynamic-ip-restrictions">тут</a> версия для IIS 7.0</p><p>Теже возможности но в IIS 8.0:</p><h3>IIS 8: динамическое ограничение доступа по IP</h3><p>Сервер IIS 7 и предыдущие версии содержали встроенную функциональность, которая позволяла администраторам разрешить или запретить доступ к серверу для определенных IP-адресов (или их диапазонов). Когда IP-адрес блокировался, любой HTTP-клиент с таким IP получал в ответ на запрос к серверу HTTP-ошибку "403.6 Forbidden". Этот функционал позволял администраторам настроить доступ к их серверу на основе активности, которую они могли проанализировать по логам сервера. Тем не менее, это был ручной процесс. Даже при том, что управление функциями могло настраиваться через скрипты для определения подозрительных пользователей с помощью анализа логов утилитами типа Microsoft's LogParser, все равно требовалось много ручной работы.</p><h3>Решение</h3><p>В IIS 8 встроенная функциональность была расширена для того, чтобы предложить следующие функции:</p><ul><li>Динамическая фильтрация IP-адресов, которая позволяет администраторам настроить их сервер на блокировку IP-адресов, которые создают слишком много запросов к серверу;</li><li>Фильтрация IP-адресов теперь позволяет администраторам указать поведение сервера во время блокировки IP-адреса, так что запросы от злоумышленников могут быть прерваны сервером, вместо того, чтобы возвращать клиенту HTTP 403.6;</li><li>Фильтрация по IP теперь поддерживает функцию прокси-режима, которая позволяет блокировать адреса не только по IP-адресу клиента, который получает сервер, но и по полученным значениям HTTP-заголовков <em>x</em><em>-forwarded</em><em>-for</em>.</li></ul><h3>Пошаговая инструкция</h3><p>Требования:</p><ul><li>Предустановленная Windows 8 с включенным IIS 8;</li></ul><p>Замечание: функция <em>IP</em><em> and</em><em> Domain</em><em> Restrictions</em> должна быть установлена вместе с IIS.</p><p><img loading="lazy" title="image" alt="image" src="http://blog.tvojdrug.ru/media/posts/74/4572.image_5F00_63ADBC501.png" width="364" height="481" border="0" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/4572.image_5F00_63ADBC501-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/4572.image_5F00_63ADBC501-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/4572.image_5F00_63ADBC501-md.png 768w"></p><h4>Конфигурирование IIS для блокировки доступа на основе HTTP-запросов</h4><p>Сервер IIS 8.0 может быть сконфигурирован для блокировки доступа к веб-сайтам на основе определенного числа запросов в единицу времени, которые производит клиент. Другим вариантом является блокировка на основе количества одновременных подключений клиента.</p><p>Для конфигурирования IIS для блокировки доступа основанной на числе HTTP-запросов проделайте следующие шаги:</p><p>Осуществите вход в систему с учетной записью администратора. Откройте <em>Internet Information Services (IIS) Manager</em>. Выберите свой сервер, сайт или папку в окне<em>Connections</em> и затем в панели функций запустите <em>IP Address and Domain Restrictions</em>.</p><p><img loading="lazy" title="image" alt="image" src="http://blog.tvojdrug.ru/media/posts/74/4276.image_5F00_4EDBC3D01.png" width="550" height="304" border="0" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/4276.image_5F00_4EDBC3D01-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/4276.image_5F00_4EDBC3D01-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/4276.image_5F00_4EDBC3D01-md.png 768w"></p><p>Нажмите <em>Edit Dynamic Restriction Settings</em> на панели <em>Actions</em>.</p><p><img loading="lazy" title="image" alt="image" src="http://blog.tvojdrug.ru/media/posts/74/1033.image_5F00_7AAC17BF1.png" width="550" height="303" border="0" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/1033.image_5F00_7AAC17BF1-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/1033.image_5F00_7AAC17BF1-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/1033.image_5F00_7AAC17BF1-md.png 768w"></p><p>В окне Dynamic IP Restriction Settings выберите <em>Deny IP Address based on the number of concurrent requests</em>, если вы хотите предотвратить слишком много одновременных подключений от пользователя. Если вы хотите предотвратить слишком большое количество запросов от пользователя, выберите <em>Deny IP Address based on the number of requests over a period of time</em>.</p><p><img loading="lazy" title="image" alt="image" src="http://blog.tvojdrug.ru/media/posts/74/2110.image_5F00_639D96831.png" width="550" height="420" border="0" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/2110.image_5F00_639D96831-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/2110.image_5F00_639D96831-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/2110.image_5F00_639D96831-md.png 768w"></p><p>Нажмите ОК.</p><h4>Конфигурирование поведения IIS при запрете IP-адресов</h4><p>В IIS 7 и ранних версиях, сервер возвращал HTTP-ошибку "403.6 Forbidden", когда происходила блокировка IP-адреса. В IIS 8.0 администраторы могут сконфигурировать свой сервер для того, чтобы запрещать доступ с IP-адресов несколькими дополнительными вариантами.</p><p>Для того чтобы указать то, как должен поступать IIS, когда он блокирует IP-адрес, выполните следующие шаги:</p><p>Осуществите вход в систему с учетной записью администратора. Откройте <em>Internet Information Services (IIS) Manager</em>. Выберите свой сервер, сайт или папку в окне<em>Connections</em> и затем в панели функций запустите <em>IP Address and Domain Restrictions</em>.</p><p><img loading="lazy" title="image" alt="image" src="http://blog.tvojdrug.ru/media/posts/74/7317.image_5F00_21B6B1351.png" width="550" height="306" border="0" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/7317.image_5F00_21B6B1351-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/7317.image_5F00_21B6B1351-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/7317.image_5F00_21B6B1351-md.png 768w"></p><p>Нажмите <em>Edit Feature Settings</em> на панели <em>Actions</em>.</p><p><img loading="lazy" title="image" alt="image" src="http://blog.tvojdrug.ru/media/posts/74/6724.image_5F00_58445C791.png" width="550" height="303" border="0" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/6724.image_5F00_58445C791-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/6724.image_5F00_58445C791-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/6724.image_5F00_58445C791-md.png 768w"></p><p>В окне <em>Edit IP and Domain Restriction Settings</em> выберите в ниспадающем меню <em>Deny Action Type</em> предпочтительное поведение сервера:</p><ul><li>Unauthorized: IIS вернет ответ HTTP 401;</li><li>Forbidden: IIS вернет ответ HTTP 403;</li><li>Not Found: IIS вернет HTTP 404;</li><li>Abort: IIS закроет HTTP-соединение.</li></ul><p><img loading="lazy" title="image" alt="image" src="http://blog.tvojdrug.ru/media/posts/74/5633.image_5F00_23C38A311.png" width="373" height="285" border="0" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/5633.image_5F00_23C38A311-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/5633.image_5F00_23C38A311-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/5633.image_5F00_23C38A311-md.png 768w"></p><p>Нажмите ОК.</p><h4>Конфигурирование IIS для прокси-режима</h4><p>Одной из проблем при IP-фильтрации является возможная ситуация, когда с одного IP-адреса на сервер обращаются множество разных клиентов (через firewall, балансировщик нагрузки, прокси). Так что для каждого такого клиента IP-адрес будет одинаковым. В IIS 8.0 администраторы могут сконфигурировать сервер с учетом HTTP-заголовка <em>x</em><em>-forwarded</em><em>-for</em>, в дополнение к IP-адресу клиента, для того, чтобы точнее определять какие именно запросы необходимо блокировать. Такое поведение называется «прокси-режимом».</p><p>Для конфигурирования IIS для прокси-режима проделайте следующие шаги.</p><p>Осуществите вход в систему с учетной записью администратора. Откройте <em>Internet Information Services (IIS) Manager</em>. Выберите свой сервер, сайт или папку в окне<em>Connections</em> и затем в панели функций запустите <em>IP Address and Domain Restrictions</em>.</p><p><img loading="lazy" title="image" alt="image" src="http://blog.tvojdrug.ru/media/posts/74/6215.image_5F00_2931FAD51.png" width="550" height="306" border="0" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/6215.image_5F00_2931FAD51-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/6215.image_5F00_2931FAD51-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/6215.image_5F00_2931FAD51-md.png 768w"></p><p>Нажмите на <em>Edit Feature Settings</em> в панели <em>Actions</em>.</p><p><img loading="lazy" title="image" alt="image" src="http://blog.tvojdrug.ru/media/posts/74/5226.image_5F00_31D253611.png" width="550" height="303" border="0" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/5226.image_5F00_31D253611-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/5226.image_5F00_31D253611-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/5226.image_5F00_31D253611-md.png 768w"></p><p>В окне Edit IP and Domain Restriction Settings выберите Enable Proxy Mode.</p><p><img loading="lazy" title="image" alt="image" src="http://blog.tvojdrug.ru/media/posts/74/8053.image_5F00_56EF9DCD1.png" width="372" height="285" border="0" sizes="(min-width: 1500px) calc(7.87vw + 610px), (min-width: 900px) calc(44.48vw + 68px), (min-width: 780px) calc(8vw + 604px), calc(84.35vw + 23px)" srcset="http://blog.tvojdrug.ru/media/posts/74/responsive/8053.image_5F00_56EF9DCD1-xs.png 300w, http://blog.tvojdrug.ru/media/posts/74/responsive/8053.image_5F00_56EF9DCD1-sm.png 480w, http://blog.tvojdrug.ru/media/posts/74/responsive/8053.image_5F00_56EF9DCD1-md.png 768w"></p><p>Нажмите ОК.</p><h3>Заключение</h3><p>В этом руководстве вы познакомились с конфигурирование IIS для динамического блокирования доступа к вашему серверу на основе числа запросов от клиента, а так же с настройкой поведения IIS, которое сервер будет использовать при блокировке потенциальных злоумышленников.</p><footer><div class="content__tag-share"><ul class="content__tag"><li><a href="http://blog.tvojdrug.ru/tags/iis/">IIS</a></li></ul><div class="content__share"></div></div><div class="content__bio"><h3><a href="http://blog.tvojdrug.ru/authors/admin/" title="GUIDETO">GUIDETO</a></h3></div></footer></div></div></article><div class="main__right main__right--bottom"></div></main><footer class="footer"><div class="footer__copyright"><span class="sub">© Все права защищены <a href="http://blog.TvojDrug.ru/">Блог про всё</a> 2013-2024</span></div></footer></div></div><script defer="defer" src="http://blog.tvojdrug.ru/assets/js/scripts.min.js?v=1ea8317abae2e05fa2a65ed7bbff7ba7"></script><script>var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }</script></body></html>
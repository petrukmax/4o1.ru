<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
            <title>Настройка Ubuntu сетевым шлюзом для раздачи интернета в локальную сеть - Blog </title>
        <meta name="description" content="Как машину с двумя сетевыми интерфейсами (в один поступает интернет, из другого — «выходит») сделать шлюзом.Допустим, что аппаратно-сетевая часть уже полностью настроена, на вашей машине имеются работоспособный интернет и вы видите другие компьютеры сети. Поэтому давайте разберемся что к чему, для этого введем команду:ifconfig" />
         
        <meta name="generator" content="Publii Open-Source CMS for Static Site" />

        <link rel="canonical" href="http://4o1.ru/nastroyka-ubuntu-setevym-shlyuzom-dlya-razdachi-interneta-v-lokalnuyu-set.html">
        <link rel="alternate" type="application/atom+xml" href="http://4o1.ru/feed.xml" />
<link rel="alternate" type="application/json" href="http://4o1.ru/feed.json" />

        <meta property="og:title" content="Настройка Ubuntu сетевым шлюзом для раздачи интернета в локальную сеть" /><meta property="og:site_name" content="Blog" /><meta property="og:description" content="Как машину с двумя сетевыми интерфейсами (в один поступает интернет, из другого — «выходит») сделать шлюзом.Допустим, что аппаратно-сетевая часть уже полностью настроена, на вашей машине имеются работоспособный интернет и вы видите другие компьютеры сети. Поэтому давайте разберемся что к чему, для этого введем команду:ifconfig" /><meta property="og:url" content="http://4o1.ru/nastroyka-ubuntu-setevym-shlyuzom-dlya-razdachi-interneta-v-lokalnuyu-set.html" /><meta property="og:type" content="article" />
        
        
        <link rel="stylesheet" href="http://4o1.ru/assets/css/fontawesome-all.min.css?v=85514f933f9e0b82460af63f1a403fa5">
        <link rel="stylesheet" href="http://4o1.ru/assets/css/style.css?v=9274fb62a8095432057114afc1a7f7fc">
        <noscript><link rel="stylesheet" href="http://4o1.ru/assets/css/noscript.css?v=efa867a99f5064d6729e4dc2008ad50b"></noscript>
        <script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"http://4o1.ru/nastroyka-ubuntu-setevym-shlyuzom-dlya-razdachi-interneta-v-lokalnuyu-set.html"},"headline":"Настройка Ubuntu сетевым шлюзом для раздачи интернета в локальную сеть","datePublished":"2012-09-24T08:39+04:00","dateModified":"2024-08-19T17:46+03:00","description":"Как машину с двумя сетевыми интерфейсами (в один поступает интернет, из другого — «выходит») сделать шлюзом.Допустим, что аппаратно-сетевая часть уже полностью настроена, на вашей машине имеются работоспособный интернет и вы видите другие компьютеры сети. Поэтому давайте разберемся что к чему, для этого введем команду:ifconfig","author":{"@type":"Person","name":"GUIDETO","url":"http://4o1.ru/authors/admin/"},"publisher":{"@type":"Organization","name":"GUIDETO"}}</script>
        <style>
           #wrapper > .bg {
               background-image: url(http://4o1.ru/assets/images/overlay.png), linear-gradient(0deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)), url();
           }
        </style>
        <noscript>
            <style>
                img[loading] {
                    opacity: 1;
                }
            </style>
        </noscript>			
        
    </head>
    <body class="is-preload post-template">
    <div id="wrapper" >


   <header id="header">
      <a class="logo" href="http://4o1.ru/">
            Blog
      </a>
   </header>

      <nav id="nav">
            <ul class="links">
                     <li>
                     <a
                        href="http://4o1.ru/tags/kouching/"
                           target="_self"
            >
                        Коучинг
                     </a>
            
               </li>
                     <li>
                     <a
                        href="http://4o1.ru/tags/psixologiya/"
                           target="_self"
            >
                        Психология
                     </a>
            
               </li>
                     <li>
                     <a
                        href="http://4o1.ru/tags/knigi/"
                           target="_self"
            >
                        Книги
                     </a>
            
               </li>
                     <li>
                     <a
                        href="http://4o1.ru/tags/video/"
                           target="_self"
            >
                        Видео
                     </a>
            
               </li>
                     <li>
                     <a
                        href="http://4o1.ru/tags/biz/"
                           target="_self"
            >
                        Бизнес
                     </a>
            
               </li>
                     <li>
                     <a
                        href="http://4o1.ru/tags/bez-rubriki/"
                           target="_self"
            >
                        Без рубрики
                     </a>
            
               </li>
                     <li>
                     <a
                        href="http://4o1.ru/tags/audiobook/"
                           target="_self"
            >
                        Аудиокниги
                     </a>
            
               </li>
                     <li>
                     <a
                        href="http://4o1.ru/tags/anglijskij/"
                           target="_self"
            >
                        Английский
                     </a>
            
               </li>
                     <li class="has-submenu">
                     <a
                        href="http://4o1.ru/tags/it/"
                           target="_self"
                           aria-haspopup="true"
                        >
                        IT
                     </a>
            
                     <ul class="nav__submenu level-2" aria-hidden="true" >
                              <li>
                              <a
                                 href="http://4o1.ru/tags/wordpress/"
                                    target="_self"
                     >
                                 WordPress
                              </a>
                     
                        </li>
                              <li>
                              <a
                                 href="http://4o1.ru/tags/seo/"
                                    target="_self"
                     >
                                 SEO
                              </a>
                     
                        </li>
                              <li class="has-submenu">
                              <a
                                 href="http://4o1.ru/tags/yazyki/"
                                    target="_self"
                                    aria-haspopup="true"
                                 >
                                 Языки
                              </a>
                     
                              <ul class="nav__submenu level-3" aria-hidden="true" >
                                       <li>
                                       <a
                                          href="http://4o1.ru/tags/html/"
                                             target="_self"
                              >
                                          HTML
                                       </a>
                              
                                 </li>
                                       <li>
                                       <a
                                          href="http://4o1.ru/tags/php/"
                                             target="_self"
                              >
                                          PHP
                                       </a>
                              
                                 </li>
                              </ul>
                                    </li>
                              <li>
                              <a
                                 href="http://4o1.ru/tags/hard/"
                                    target="_self"
                     >
                                 Железо
                              </a>
                     
                        </li>
                              <li>
                              <a
                                 href="http://4o1.ru/tags/android/"
                                    target="_self"
                     >
                                 Android
                              </a>
                     
                        </li>
                              <li class="has-submenu">
                              <a
                                 href="http://4o1.ru/tags/windows/"
                                    target="_self"
                                    aria-haspopup="true"
                                 >
                                 Windows
                              </a>
                     
                              <ul class="nav__submenu level-3" aria-hidden="true" >
                                       <li>
                                       <a
                                          href="http://4o1.ru/tags/iis/"
                                             target="_self"
                              >
                                          IIS
                                       </a>
                              
                                 </li>
                              </ul>
                                    </li>
                              <li class="has-submenu">
                              <a
                                 href="http://4o1.ru/tags/unix/"
                                    target="_self"
                                    aria-haspopup="true"
                                 >
                                 Unix
                              </a>
                     
                              <ul class="nav__submenu level-3" aria-hidden="true" >
                                       <li>
                                       <a
                                          href="http://4o1.ru/tags/apache/"
                                             target="_self"
                              >
                                          Apache
                                       </a>
                              
                                 </li>
                                       <li>
                                       <a
                                          href="http://4o1.ru/tags/asterisk/"
                                             target="_self"
                              >
                                          Asterisk
                                       </a>
                              
                                 </li>
                              </ul>
                                    </li>
                     </ul>
                           </li>
            </ul>
                     </nav>

<main id="main">
      <article class="post">
            <header class="major">
                  <time datetime="2012-09-24T08:39" class="date">
                        сентябрь 24, 2012
                  </time>
               <h1>
                  Настройка Ubuntu сетевым шлюзом для раздачи интернета в локальную сеть
               </h1>
               <p class="post__inner"></p>
            </header>


         <div class="post__inner post__entry">           
            <p>Как машину с двумя сетевыми интерфейсами (в один поступает интернет, из другого — «выходит») сделать шлюзом.</p>
<p>

Допустим, что аппаратно-сетевая часть уже полностью настроена, на вашей машине имеются работоспособный интернет и вы видите другие компьютеры сети. Поэтому давайте разберемся что к чему, для этого введем команду:</p>
<p>

<code>ifconfig</code></p>

<p>

Она выдаст список работающих в данный момент сетевых интерфейсов. Среди них надо опознать те, что начинаются со слов «Link encap:Ethernet» — это интерфейсы сетевых карт. Как правило, это eth0 и eth1.</p>
<p>Теперь потребуется опознать в какой из них поступает интернет, а из какого «выходит». Проще всего это сделать по их ip-адресам.</p>
<p>Итак, допустим через eth0 вы получаете интернет (например через adsl-модем по протоколу ppp), а eth1 связывает вас с локальной сетью.</p>
<p>Если локальная сеть настроена через <em>Network Manager</em>, то мы рекомендуем прописать эти настройки непосредственно в системном конфигурационном файле сети:</p>
<p>

<code>sudo nano /etc/network/interfaces</code></p>
<p>

Здесь исправьте настройки вашего сетевого интерфейса, подключенного к локальной сети (в нашем случае eth1), соответствующим образом:</p>
<p>

<code>auto eth1</p>
<p>iface eth1 inet static</p>
<p>address 192.168.0.10</p>
<p>netmask 255.255.255.0</p>
<p>network 192.168.0.0</p>
<p>broadcast 192.168.0.255</code></p>
<p>

Значение address — это айпи вашей машины в локальной сети, по этому адресу собственно и будет располагаться шлюз.</p>
<p>Значение netmask — в локальных сетях для этого диапазона чаще всего такая. Для других диапазонов <a href="http://www.subnetmask.info/">можно вычислить здесь</a>.</p>
<p>Значения network и broadcast будут зависеть от вашего адреса. То есть, если ваш локальный ip — 10.0.0.10, то network и broadcast будут 10.0.0.0 и 10.255.255.255 соответственно.</p>
<p>

Либо, это можно проделать всего одной командой:</p>
<p>

<code>sudo ifconfig eth1 192.168.0.10</code></p>
<p>

Эта команда самостоятельно настроит вашу сетевую карту eth1 на использование статичного айпи-адреса, и самостоятельно пропишет описанные выше настройки в файл<em>/etc/network/interfaces</em></p>
<p>

В любом случае, после этих изменений перезапустите networking:</p>
<p>

<code>sudo /etc/init.d/networking restart</code></p>
<p>

Командой:</p>
<p>

<code>ifconfig</code></p>
<p>

проверьте, что изменения вступили в силу и все работает.</p>
<p>

Теперь осталось дело за малым. В случае если вы уже пытались настроить вашу систему шлюзом, но у вас не получилось или по каким-то другим причинам вы желаете обнулить все настройки файрвола iptables, то это можно сделать следующими командами:</p>
<p>

<code>iptables --flush</p>
<p>iptables --table nat --flush</p>
<p>iptables --delete-chain</p>
<p>iptables --table nat --delete-chain</code></p>
<p>

Если прямой необходимости в сбросе настроек iptables нет, то лучше этого не делать.</p>
<p>

Следующие команды настроят ваш iptables для NAT-трансляции (NAT, Network Address Translation — «преобразование сетевых адресов») через Ubuntu-шлюз:</p>
<p>

<code>sudo iptables -A FORWARD -i eth0 -o eth1 -s 192.168.0.0/24 -m conntrack --ctstate NEW -j ACCEPT</p>
<p>sudo iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT</p>
<p>sudo iptables -A POSTROUTING -t nat -j MASQUERADE</code></p>
<p>

Если необходимые вам сетевые интерфейсы отличаются от eth0 и eth1, то просто измените первую строку соответствующим образом.</p>
<p>Если ваша локальная сеть находится вне диапазона 192.168.x.x, то маску подсети для указания в первой строке вы сможете легко вычислить через <a href="http://www.subnetmask.info/">сервис <em>Network Calculators</em></a>.</p>
<p>

Теперь для конфигурации gateway’я для роутинга между двумя интерфейсами необходимо включить IP-форвардинг командой:</p>
<p>

<code>sudo sh -c "echo 1 > /proc/sys/net/ipv4/ip_forward"</code></p>
<p>

И последний штрих: надо отредактировать файл <em>sysctl.conf</em>:</p>
<p>

<code>sudo nano /etc/sysctl.conf</code></p>
<p>

Добавьте в него вот эти две строки для активации роутинга:</p>
<p>

<code>net.ipv4.conf.default.forwarding=1</p>
<p>net.ipv4.conf.all.forwarding=1</code></p>
<p>

После этого ваш Ubuntu-шлюз готов к работе. Можете настраивать клиентские машины. На нашем примере для них gateway будет 192.168.0.10</p>
<p>

Если все внесенные вами изменения работают корректно и вы желаете внести эти настройки в автозагрузку (а именно, вышеприведенные настройки <em>iptables</em> теряют активность после перезагрузки системы), то сохраните нынешнюю рабочую конфигурацию <em>iptables</em> в файл командой:</p>
<p>

<code>sudo sh -c "iptables-save > /etc/iptables.up.rules"</code></p>
<p>

После этого в сам файл сетевых настроек /etc/network/interfaces (<code>sudo nano /etc/network/interfaces</code>) к описанию вашего сетевого интерфейса, из которого к вам поступает интернет (в нашем случае — это eth0) добавьте строку:</p>
<p>

<code>pre-up iptables-restore < /etc/iptables.up.rules</code></p>
<p>

То есть оно станет примерно такого вида:</p>
<p>

<code>auto eth0</p>
<p>iface eth0 inet manual</p>
<p>pre-up iptables-restore < /etc/iptables.up.rules</code></p>
<p>

Только не меняйте значения в строке iface, просто добавьте указанную строку последней в разделе auto eth0. После этого при перезагрузке сохраненные настройки <em>iptables</em>будут подниматься автоматически.</p>
            
         </div>

            <footer class="post__inner post__footer">

                     <p class="post__last-updated">
                        This article was updated on
                           август 19, 2024
                     </p>
               
                  <div class="post__share-tag-container">
                           <div class="post__tag">
                              <h3>Tagged in:</h3>
                                 <ul>
                                       <li>
                                          <a href="http://4o1.ru/tags/it/">IT</a>
                                       </li>
                                       <li>
                                          <a href="http://4o1.ru/tags/unix/">Unix</a>
                                       </li>
                                 </ul>
                           </div>
                
                        <div class="post__share">
                           <button
                              class="post__share-button js-post__share-button icon"
                              aria-label="Share button">
                              <i class="fas fa-share-alt"></i>
                           </button>

                           <div class="post__share-popup js-post__share-popup">
                                 
                           </div>
                        </div>        
                  </div>

                  <div class="post__bio">
                        <div>
                           <h3>
                              <a href="http://4o1.ru/authors/admin/" class="invert" rel="author">GUIDETO</a>
                           </h3>
                           
                        </div>
                  </div>
            </footer>
      </article>


            <div>
               <strong>You should also read:</strong>
            </div>
            <div class="posts">                 
                     <article>
                        <header>
                              <time datetime="2013-01-30T17:25" class="date">
                                    январь 30, 2013
                              </time>
                           <h2>
                              <a href="http://4o1.ru/migraciyu-s-php-53-na-php-52-v-ubuntu.html">Миграцию с php 5.3 на php 5.2 в Ubuntu</a>
                           </h2>
                        </header>


                        <p><p>Итак приступаем к воплощению наших требований к php. 1. Установите репозиторий: Установим пакет: python-software-properties, командой</p>
<div>
<div>apt-get install python-software-properties</div>
</div>
<p>

, незабываем про права. После установки пакета вводим следующую команду:</p>
<div>
<div>add-apt-repository ppa:txwikinger/php5.2</div>
</p>
<div>
</p>

                           <ul class="actions special">
                              <li>
                                 <a href="http://4o1.ru/migraciyu-s-php-53-na-php-52-v-ubuntu.html" class="button">Full Story</a>
                              </li>
                           </ul>

                     </article>
                     <article>
                        <header>
                              <time datetime="2012-10-03T14:13" class="date">
                                    октябрь 3, 2012
                              </time>
                           <h2>
                              <a href="http://4o1.ru/nastraivaem-svyazku-apache2-mod_wsgi-django-pod-ubuntu-centos.html">Настраиваем связку apache2, mod_wsgi, django под ubuntu, centos</a>
                           </h2>
                        </header>


                        <p><p>В этом посте опишу последовательность шагов для установки связки <strong>apache2</strong>,<strong>mod_wsgi 3.2</strong>, <strong>django 1.1</strong> под <strong>ubuntu 9.10</strong> и <strong>centos 5.4</strong>.</p>
<p>

<strong>Под ubuntu 9.10</strong></p>
<p>

<strong>Ставим apache2</strong></p>
<p>

Устанавливаем apache2 и сопутствующие модули:</p>
<pre data-result="[object Object]">sudo apt-get install apache2 apache2.2-common apache2-mpm-prefork apache2-utils libexpat1 ssl-cert build-essential</pre>
</p>
</p>

                           <ul class="actions special">
                              <li>
                                 <a href="http://4o1.ru/nastraivaem-svyazku-apache2-mod_wsgi-django-pod-ubuntu-centos.html" class="button">Full Story</a>
                              </li>
                           </ul>

                     </article>
                     <article>
                        <header>
                              <time datetime="2012-10-03T11:37" class="date">
                                    октябрь 3, 2012
                              </time>
                           <h2>
                              <a href="http://4o1.ru/nastroyka-asterisknow-posle-ustanovki-eng.html">Настройка AsteriskNow после установки (Eng)</a>
                           </h2>
                        </header>


                        <p><p>Well after much researching I have complied a procedure to help people install AsteiskNow from scratch. Hope this helps.</p>
<p>

Install AsteriskNOW 1.5.0 from CD.</p>
<p>After installation first boot will prompt with Setup-Agent to enter IP address, subnet mask, and gateway.</p>
<p>

# vi /etc/resolv.conf</p>
<p>(add DNS servers ex. Nameserver 192.168.1.2)</p>
<p>

# /etc/init.d/network restart</p>
<p>

# yum update</p>
<p>(reply ’y’ when prompted.)</p>
</p>

                           <ul class="actions special">
                              <li>
                                 <a href="http://4o1.ru/nastroyka-asterisknow-posle-ustanovki-eng.html" class="button">Full Story</a>
                              </li>
                           </ul>

                     </article>
                     <article>
                        <header>
                              <time datetime="2012-09-26T10:23" class="date">
                                    сентябрь 26, 2012
                              </time>
                           <h2>
                              <a href="http://4o1.ru/nastroyka-seti-v-centos.html">Настройка сети в CentOS</a>
                           </h2>
                        </header>


                        <p><p>Настройки сетевых интерфейсов в CentOS находятся в:</p>
<div>
<ol>
<li>/etc/sysconfig/network-scripts/ifcfg-ethХ</li>
</ol>
</div>
<p>

- где X номер вашего интерфеса</p>
</p>

                           <ul class="actions special">
                              <li>
                                 <a href="http://4o1.ru/nastroyka-seti-v-centos.html" class="button">Full Story</a>
                              </li>
                           </ul>

                     </article>
               </div>
           


</main>

   <footer id="copyright">
       <ul><li>&copy; Massively</li><li>Design: <a href="https://html5up.net" target="_blank" rel="nofollow noopener">HTML5 UP</a></li><li>Powered by Publii</li></ul>
    </footer>
</div>

<script  src="http://4o1.ru/assets/js/jquery.min.js?v=c9771cc3e90e18f5336eedbd0fffb2cf"></script>
<script  src="http://4o1.ru/assets/js/jquery.scrollex.min.js?v=f89065e3d988006af9791b44561d7c90"></script>
<script  src="http://4o1.ru/assets/js/jquery.scrolly.min.js?v=1ed5a78bde1476875a40f6b9ff44fc14"></script>
<script  src="http://4o1.ru/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script>
<script  src="http://4o1.ru/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script>
<script  src="http://4o1.ru/assets/js/util.min.js?v=4201a626f8c9b614a663b3a1d7d82615"></script>
<script  src="http://4o1.ru/assets/js/main.min.js?v=56233c354bd814758be8bff42f7e13a5"></script>

   <script>/*<![CDATA[*/var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};/*]]>*/</script>





</body>
</html>

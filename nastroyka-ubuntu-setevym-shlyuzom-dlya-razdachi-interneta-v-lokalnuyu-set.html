<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
            <title>Настройка Ubuntu сетевым шлюзом для раздачи интернета в локальную сеть - Blog </title>
        <meta name="description" content="Как машину с двумя сетевыми интерфейсами (в один поступает интернет, из другого — «выходит») сделать шлюзом.Допустим, что аппаратно-сетевая часть уже полностью настроена, на вашей машине имеются работоспособный интернет и вы видите другие компьютеры сети. Поэтому давайте разберемся что к чему, для этого введем команду:ifconfig" />
        
        <meta name="generator" content="Publii Open-Source CMS for Static Site" />

        <link rel="canonical" href="https://blog.tvojdrug.ru/nastroyka-ubuntu-setevym-shlyuzom-dlya-razdachi-interneta-v-lokalnuyu-set.html">
        <link rel="alternate" type="application/atom+xml" href="https://blog.tvojdrug.ru/feed.xml" />
<link rel="alternate" type="application/json" href="https://blog.tvojdrug.ru/feed.json" />

        <meta property="og:title" content="Настройка Ubuntu сетевым шлюзом для раздачи интернета в локальную сеть" /><meta property="og:site_name" content="Blog" /><meta property="og:description" content="Как машину с двумя сетевыми интерфейсами (в один поступает интернет, из другого — «выходит») сделать шлюзом.Допустим, что аппаратно-сетевая часть уже полностью настроена, на вашей машине имеются работоспособный интернет и вы видите другие компьютеры сети. Поэтому давайте разберемся что к чему, для этого введем команду:ifconfig" /><meta property="og:url" content="https://blog.tvojdrug.ru/nastroyka-ubuntu-setevym-shlyuzom-dlya-razdachi-interneta-v-lokalnuyu-set.html" /><meta property="og:type" content="article" />
        
        <link rel="stylesheet" href="https://blog.tvojdrug.ru/assets/css/style.css?v=984cc9f9fa9fd7a0b9529b5c6d9033e9">
        <script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.tvojdrug.ru/nastroyka-ubuntu-setevym-shlyuzom-dlya-razdachi-interneta-v-lokalnuyu-set.html"},"headline":"Настройка Ubuntu сетевым шлюзом для раздачи интернета в локальную сеть","datePublished":"2012-09-24T08:39","dateModified":"2024-08-19T17:46","description":"Как машину с двумя сетевыми интерфейсами (в один поступает интернет, из другого — «выходит») сделать шлюзом.Допустим, что аппаратно-сетевая часть уже полностью настроена, на вашей машине имеются работоспособный интернет и вы видите другие компьютеры сети. Поэтому давайте разберемся что к чему, для этого введем команду:ifconfig","author":{"@type":"Person","name":"GUIDETO","url":"https://blog.tvojdrug.ru/authors/admin/"},"publisher":{"@type":"Organization","name":"GUIDETO"}}</script>      
        <noscript>
            <style>
                img[loading] {
                    opacity: 1;
                }
            </style>
        </noscript>      
        
    </head>
    <body class="post-template">
        
<div class="container js-container">
      <nav class="menu">
          <ul class="navbar__menu">
                  <li>
                      <a 
                      href="https://blog.tvojdrug.ru/tags/kouching/"
                          target="_self"
      >
                      Коучинг </a>              
              </li>
                  <li>
                      <a 
                      href="https://blog.tvojdrug.ru/tags/psixologiya/"
                          target="_self"
      >
                      Психология </a>              
              </li>
                  <li>
                      <a 
                      href="https://blog.tvojdrug.ru/tags/knigi/"
                          target="_self"
      >
                      Книги </a>              
              </li>
                  <li>
                      <a 
                      href="https://blog.tvojdrug.ru/tags/video/"
                          target="_self"
      >
                      Видео </a>              
              </li>
                  <li>
                      <a 
                      href="https://blog.tvojdrug.ru/tags/biz/"
                          target="_self"
      >
                      Бизнес </a>              
              </li>
                  <li>
                      <a 
                      href="https://blog.tvojdrug.ru/tags/bez-rubriki/"
                          target="_self"
      >
                      Без рубрики </a>              
              </li>
                  <li>
                      <a 
                      href="https://blog.tvojdrug.ru/tags/audiobook/"
                          target="_self"
      >
                      Аудиокниги </a>              
              </li>
                  <li>
                      <a 
                      href="https://blog.tvojdrug.ru/tags/anglijskij/"
                          target="_self"
      >
                      Английский </a>              
              </li>
                  <li class="has-submenu">
                      <a 
                      href="https://blog.tvojdrug.ru/tags/it/"
                          target="_self"
      >
                      IT </a>              
                          <ul class="navbar__submenu" >
                                  <li>
                                      <a 
                                      href="https://blog.tvojdrug.ru/tags/wordpress/"
                                          target="_self"
                      >
                                      WordPress </a>              
                              </li>
                                  <li>
                                      <a 
                                      href="https://blog.tvojdrug.ru/tags/seo/"
                                          target="_self"
                      >
                                      SEO </a>              
                              </li>
                                  <li class="has-submenu">
                                      <a 
                                      href="https://blog.tvojdrug.ru/tags/yazyki/"
                                          target="_self"
                      >
                                      Языки </a>              
                                          <ul class="navbar__submenu" >
                                                  <li>
                                                      <a 
                                                      href="https://blog.tvojdrug.ru/tags/html/"
                                                          target="_self"
                                      >
                                                      HTML </a>              
                                              </li>
                                                  <li>
                                                      <a 
                                                      href="https://blog.tvojdrug.ru/tags/php/"
                                                          target="_self"
                                      >
                                                      PHP </a>              
                                              </li>
                                          </ul>
                              </li>
                                  <li>
                                      <a 
                                      href="https://blog.tvojdrug.ru/tags/hard/"
                                          target="_self"
                      >
                                      Железо </a>              
                              </li>
                                  <li>
                                      <a 
                                      href="https://blog.tvojdrug.ru/tags/android/"
                                          target="_self"
                      >
                                      Android </a>              
                              </li>
                                  <li class="has-submenu">
                                      <a 
                                      href="https://blog.tvojdrug.ru/tags/windows/"
                                          target="_self"
                      >
                                      Windows </a>              
                                          <ul class="navbar__submenu" >
                                                  <li>
                                                      <a 
                                                      href="https://blog.tvojdrug.ru/tags/iis/"
                                                          target="_self"
                                      >
                                                      IIS </a>              
                                              </li>
                                          </ul>
                              </li>
                                  <li class="has-submenu">
                                      <a 
                                      href="https://blog.tvojdrug.ru/tags/unix/"
                                          target="_self"
                      >
                                      Unix </a>              
                                          <ul class="navbar__submenu" >
                                                  <li>
                                                      <a 
                                                      href="https://blog.tvojdrug.ru/tags/apache/"
                                                          target="_self"
                                      >
                                                      Apache </a>              
                                              </li>
                                                  <li>
                                                      <a 
                                                      href="https://blog.tvojdrug.ru/tags/asterisk/"
                                                          target="_self"
                                      >
                                                      Asterisk </a>              
                                              </li>
                                          </ul>
                              </li>
                          </ul>
              </li>
          </ul>
      </nav>
   <div class="container__content">
      <header class="top">
         <div class="top__item">
            <a class="logo" href="https://blog.tvojdrug.ru/">
                  Blog
            </a>
         </div>
         <div class="top__item top__item--right">
              <button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false">
						<span class="menu-toggle-box">
							<span class="menu-toggle-inner"> Menu</span>
						</span>
					</button>
         </div>
      </header>   <main class="main post">
         <article class="content">
            <div class="main__left">
                        <figure class="hero">
                           <img
                              src="https://blog.tvojdrug.ru/media/website/111222-4.jpg"
                                  srcset="https://blog.tvojdrug.ru/media/website/responsive/111222-4-xs.jpg 300w ,https://blog.tvojdrug.ru/media/website/responsive/111222-4-sm.jpg 480w ,https://blog.tvojdrug.ru/media/website/responsive/111222-4-md.jpg 768w ,https://blog.tvojdrug.ru/media/website/responsive/111222-4-lg.jpg 1024w ,https://blog.tvojdrug.ru/media/website/responsive/111222-4-xl.jpg 1280w ,https://blog.tvojdrug.ru/media/website/responsive/111222-4-2xl.jpg 1600w"   sizes="(min-width: 1800px) 50vw, (min-width: 900px) 40vw, 100vw" 
                               loading="eager"
                               width="3840" height="2160" 
                              alt="">

                        </figure>

               <header>
                  <h1>Настройка Ubuntu сетевым шлюзом для раздачи интернета в локальную сеть</h1>
                     <p>
                           <time datetime="2012-09-24T08:39">
                                 сентябрь 24, 2012
                           </time>
                           by
                              <a href="https://blog.tvojdrug.ru/authors/admin/" rel="author" title="GUIDETO">GUIDETO</a>
                     </p>
               </header>
            </div>
            <div class="main__right">
               <div class="content__entry">
                     <p>Как машину с двумя сетевыми интерфейсами (в один поступает интернет, из другого — «выходит») сделать шлюзом.</p>
<p>

Допустим, что аппаратно-сетевая часть уже полностью настроена, на вашей машине имеются работоспособный интернет и вы видите другие компьютеры сети. Поэтому давайте разберемся что к чему, для этого введем команду:</p>
<p>

<code>ifconfig</code></p>

<p>

Она выдаст список работающих в данный момент сетевых интерфейсов. Среди них надо опознать те, что начинаются со слов «Link encap:Ethernet» — это интерфейсы сетевых карт. Как правило, это eth0 и eth1.</p>
<p>Теперь потребуется опознать в какой из них поступает интернет, а из какого «выходит». Проще всего это сделать по их ip-адресам.</p>
<p>Итак, допустим через eth0 вы получаете интернет (например через adsl-модем по протоколу ppp), а eth1 связывает вас с локальной сетью.</p>
<p>Если локальная сеть настроена через <em>Network Manager</em>, то мы рекомендуем прописать эти настройки непосредственно в системном конфигурационном файле сети:</p>
<p>

<code>sudo nano /etc/network/interfaces</code></p>
<p>

Здесь исправьте настройки вашего сетевого интерфейса, подключенного к локальной сети (в нашем случае eth1), соответствующим образом:</p>
<p>

<code>auto eth1</p>
<p>iface eth1 inet static</p>
<p>address 192.168.0.10</p>
<p>netmask 255.255.255.0</p>
<p>network 192.168.0.0</p>
<p>broadcast 192.168.0.255</code></p>
<p>

Значение address — это айпи вашей машины в локальной сети, по этому адресу собственно и будет располагаться шлюз.</p>
<p>Значение netmask — в локальных сетях для этого диапазона чаще всего такая. Для других диапазонов <a href="http://www.subnetmask.info/">можно вычислить здесь</a>.</p>
<p>Значения network и broadcast будут зависеть от вашего адреса. То есть, если ваш локальный ip — 10.0.0.10, то network и broadcast будут 10.0.0.0 и 10.255.255.255 соответственно.</p>
<p>

Либо, это можно проделать всего одной командой:</p>
<p>

<code>sudo ifconfig eth1 192.168.0.10</code></p>
<p>

Эта команда самостоятельно настроит вашу сетевую карту eth1 на использование статичного айпи-адреса, и самостоятельно пропишет описанные выше настройки в файл<em>/etc/network/interfaces</em></p>
<p>

В любом случае, после этих изменений перезапустите networking:</p>
<p>

<code>sudo /etc/init.d/networking restart</code></p>
<p>

Командой:</p>
<p>

<code>ifconfig</code></p>
<p>

проверьте, что изменения вступили в силу и все работает.</p>
<p>

Теперь осталось дело за малым. В случае если вы уже пытались настроить вашу систему шлюзом, но у вас не получилось или по каким-то другим причинам вы желаете обнулить все настройки файрвола iptables, то это можно сделать следующими командами:</p>
<p>

<code>iptables --flush</p>
<p>iptables --table nat --flush</p>
<p>iptables --delete-chain</p>
<p>iptables --table nat --delete-chain</code></p>
<p>

Если прямой необходимости в сбросе настроек iptables нет, то лучше этого не делать.</p>
<p>

Следующие команды настроят ваш iptables для NAT-трансляции (NAT, Network Address Translation — «преобразование сетевых адресов») через Ubuntu-шлюз:</p>
<p>

<code>sudo iptables -A FORWARD -i eth0 -o eth1 -s 192.168.0.0/24 -m conntrack --ctstate NEW -j ACCEPT</p>
<p>sudo iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT</p>
<p>sudo iptables -A POSTROUTING -t nat -j MASQUERADE</code></p>
<p>

Если необходимые вам сетевые интерфейсы отличаются от eth0 и eth1, то просто измените первую строку соответствующим образом.</p>
<p>Если ваша локальная сеть находится вне диапазона 192.168.x.x, то маску подсети для указания в первой строке вы сможете легко вычислить через <a href="http://www.subnetmask.info/">сервис <em>Network Calculators</em></a>.</p>
<p>

Теперь для конфигурации gateway’я для роутинга между двумя интерфейсами необходимо включить IP-форвардинг командой:</p>
<p>

<code>sudo sh -c "echo 1 > /proc/sys/net/ipv4/ip_forward"</code></p>
<p>

И последний штрих: надо отредактировать файл <em>sysctl.conf</em>:</p>
<p>

<code>sudo nano /etc/sysctl.conf</code></p>
<p>

Добавьте в него вот эти две строки для активации роутинга:</p>
<p>

<code>net.ipv4.conf.default.forwarding=1</p>
<p>net.ipv4.conf.all.forwarding=1</code></p>
<p>

После этого ваш Ubuntu-шлюз готов к работе. Можете настраивать клиентские машины. На нашем примере для них gateway будет 192.168.0.10</p>
<p>

Если все внесенные вами изменения работают корректно и вы желаете внести эти настройки в автозагрузку (а именно, вышеприведенные настройки <em>iptables</em> теряют активность после перезагрузки системы), то сохраните нынешнюю рабочую конфигурацию <em>iptables</em> в файл командой:</p>
<p>

<code>sudo sh -c "iptables-save > /etc/iptables.up.rules"</code></p>
<p>

После этого в сам файл сетевых настроек /etc/network/interfaces (<code>sudo nano /etc/network/interfaces</code>) к описанию вашего сетевого интерфейса, из которого к вам поступает интернет (в нашем случае — это eth0) добавьте строку:</p>
<p>

<code>pre-up iptables-restore < /etc/iptables.up.rules</code></p>
<p>

То есть оно станет примерно такого вида:</p>
<p>

<code>auto eth0</p>
<p>iface eth0 inet manual</p>
<p>pre-up iptables-restore < /etc/iptables.up.rules</code></p>
<p>

Только не меняйте значения в строке iface, просто добавьте указанную строку последней в разделе auto eth0. После этого при перезагрузке сохраненные настройки <em>iptables</em>будут подниматься автоматически.</p>

                     
                     <footer>

                           <div class="content__tag-share">

                                    <ul class="content__tag">
                                          <li>
                                             <a href="https://blog.tvojdrug.ru/tags/it/">IT</a>
                                          </li>
                                          <li>
                                             <a href="https://blog.tvojdrug.ru/tags/unix/">Unix</a>
                                          </li>
                                    </ul>

                                    <div class="content__share">
                                       
                                       
                                       
                                       
                                       
                                       
                                    </div>

                           </div>

                              <div class="content__bio">
                                    <h3>
                                       <a href="https://blog.tvojdrug.ru/authors/admin/" title="GUIDETO">GUIDETO</a>
                                    </h3>
                              </div>
                     </footer>
               </div>
            </div>
         </article>

            <div class="main__right main__right--bottom">
                     <div class="related">
                        <h2 class="related__title">
                           Related posts:
                        </h2>
                        <ul class="related__items">
                              <li class="related__item">
                                 <h3 class="h5">
                                    <a href="https://blog.tvojdrug.ru/nastroyka-asterisknow-posle-ustanovki-eng.html">
                                       Настройка AsteriskNow после установки (Eng)
                                    </a>
                                 </h3>
                                 
                              </li>
                              <li class="related__item">
                                 <h3 class="h5">
                                    <a href="https://blog.tvojdrug.ru/nastroyka-seti-v-centos.html">
                                       Настройка сети в CentOS
                                    </a>
                                 </h3>
                                 
                              </li>
                              <li class="related__item">
                                 <h3 class="h5">
                                    <a href="https://blog.tvojdrug.ru/nastroyka-seti-cherez-konsol-skript-nastroyki.html">
                                       Настройка сети через консоль, скрипт настройки
                                    </a>
                                 </h3>
                                 
                              </li>
                        </ul>
                     </div>

                 
            </div>

   </main>
   <footer class="footer">
         <div class="footer__copyright">
            <span class="sub">© Все права защищены <a href="http://blog.TvojDrug.ru/">Блог про всё</a> 2013-2024</span></div>
         </div>
   </footer>
   </div>
   </div>
   <script defer src="https://blog.tvojdrug.ru/assets/js/scripts.min.js?v=1ea8317abae2e05fa2a65ed7bbff7ba7"></script>
       <script>        
           var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }
       </script>
   
   
   
   
   
   </body>
   </html>